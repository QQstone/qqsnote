<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/qqsnote/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/qqsnote/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/qqsnote/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/qqsnote/images/logo.svg" color="#222">

<link rel="stylesheet" href="/qqsnote/css/main.css">


<link rel="stylesheet" href="/qqsnote/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"qqstone.github.io","root":"/qqsnote/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.json"};
  </script>

  <meta name="description" content="背景公司Legacy SSO使用场景已经很少， 逐步转向Azure ADB2C，员工常遗忘其Legacy SSO的密码，由于企业Azure ADB2C申请比较麻烦，而且资产系统需求未必符合普适性，故自行搭建SSO服务参考CNBlog:从零搭建一个IdentityServer 需求对于从未接触过Legacy SSO的员工以及未来Legacy SSO废止的风险下，允许员工使用其工号或邮箱+密码或邮件验">
<meta property="og:type" content="article">
<meta property="og:title" content="Identity Server">
<meta property="og:url" content="http://qqstone.github.io/qqsnote/2021/09/24/IdentityServer/index.html">
<meta property="og:site_name" content="QQs&#39;Note">
<meta property="og:description" content="背景公司Legacy SSO使用场景已经很少， 逐步转向Azure ADB2C，员工常遗忘其Legacy SSO的密码，由于企业Azure ADB2C申请比较麻烦，而且资产系统需求未必符合普适性，故自行搭建SSO服务参考CNBlog:从零搭建一个IdentityServer 需求对于从未接触过Legacy SSO的员工以及未来Legacy SSO废止的风险下，允许员工使用其工号或邮箱+密码或邮件验">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2021-09-24T01:43:54.000Z">
<meta property="article:modified_time" content="2025-07-05T02:07:52.111Z">
<meta property="article:author" content="QQs">
<meta property="article:tag" content=".Net">
<meta property="article:tag" content="认证&amp;授权">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://qqstone.github.io/qqsnote/2021/09/24/IdentityServer/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>Identity Server | QQs'Note</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/qqsnote/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">QQs'Note</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/qqsnote/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/qqsnote/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://qqstone.github.io/qqsnote/2021/09/24/IdentityServer/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/qqsnote/images/avatar.gif">
      <meta itemprop="name" content="QQs">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="QQs'Note">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Identity Server
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-09-24 09:43:54" itemprop="dateCreated datePublished" datetime="2021-09-24T09:43:54+08:00">2021-09-24</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-07-05 10:07:52" itemprop="dateModified" datetime="2025-07-05T10:07:52+08:00">2025-07-05</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h4 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h4><p>公司Legacy SSO使用场景已经很少， 逐步转向Azure ADB2C，员工常遗忘其Legacy SSO的密码，<br>由于企业Azure ADB2C申请比较麻烦，而且资产系统需求未必符合普适性，故自行搭建SSO服务<br>参考<a target="_blank" rel="noopener" href="https://www.cnblogs.com/selimsong/p/14328840.html">CNBlog:从零搭建一个IdentityServer</a></p>
<h4 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h4><p>对于从未接触过Legacy SSO的员工以及未来Legacy SSO废止的风险下，允许员工使用其工号或邮箱+密码或邮件验证码通过认证</p>
<ul>
<li>跳转到Identity Server使用工号或邮箱+密码认证</li>
<li>NG Client APP使用Identity Server授予的access token访问后台</li>
<li>忘记密码跳转到Identity Server使用邮箱验证码重置<br>进阶</li>
<li>将角色权限迁移至Identity Server<h4 id="is4"><a href="#is4" class="headerlink" title="is4"></a>is4</h4>identity server4 是作为OpenID Connect provider中间件 </li>
</ul>
<p>有限的免费： free for dev/testing/personal projects and companies or individuals making less than 1M USD gross annnual revenue</p>
<p>首先安装dotnet cli提供的identityserver模板<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dotnet new -i IdentityServer4.Templates</span><br></pre></td></tr></table></figure><br>提供了以下模板<br>IdentityServer4 with AdminUI                          is4admin<br>IdentityServer4 with ASP.NET Core Identity            is4aspid<br>IdentityServer4 Empty                                 is4empty<br>IdentityServer4 with Entity Framework Stores          is4ef<br>IdentityServer4 with In-Memory Stores and Test Users  is4inmem<br>IdentityServer4 Quickstart UI (UI assets only)        is4ui<br>入门：<br>入门项目包含三个部分，身份认证服务(<a target="_blank" rel="noopener" href="https://localhost:5001">https://localhost:5001</a>), API(<a target="_blank" rel="noopener" href="https://localhost:44323/identity">https://localhost:44323/identity</a>), Client(一个console program)</p>
<ol>
<li><p>创建身份认证服务</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">dotnet new is4empty -n IdentityServer</span><br><span class="line">cd ..</span><br><span class="line">dotnet new sln -n Quickstart</span><br><span class="line">dotnet sln add .\src\IdentityServer\IdentityServer.csproj</span><br></pre></td></tr></table></figure>
<p>在Config.cs中定义API scope</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">public static IEnumerable&lt;ApiScope&gt; ApiScopes &#x3D;&gt;</span><br><span class="line">        new ApiScope[]</span><br><span class="line">        &#123;</span><br><span class="line">            new ApiScope(&quot;api1&quot;, &quot;My API&quot;)</span><br><span class="line">        &#125;;</span><br></pre></td></tr></table></figure>
<p>在Config.cs中定义访问API的client</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">public static IEnumerable&lt;Client&gt; Clients &#x3D;&gt;</span><br><span class="line">        new Client[] </span><br><span class="line">        &#123;</span><br><span class="line">            new Client</span><br><span class="line">            &#123;</span><br><span class="line">                ClientId &#x3D; &quot;client&quot;,</span><br><span class="line">                ClientSecrets &#x3D;</span><br><span class="line">                &#123;</span><br><span class="line">                    new Secret(&quot;secrec&quot;.Sha256())</span><br><span class="line">                &#125;,</span><br><span class="line">                AllowedGrantTypes &#x3D; GrantTypes.ClientCredentials,</span><br><span class="line">                AllowedScopes &#x3D; &#123; &quot;api1&quot; &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br></pre></td></tr></table></figure>
<p>该client使用clientCredential(id+secret)认证 允许访问名为api1的scope<br>在startup.cs中载入资源以及client</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">public void ConfigureServices(IServiceCollection services)</span><br><span class="line">&#123;</span><br><span class="line">    var builder &#x3D; services.AddIdentityServer()</span><br><span class="line">        .AddDeveloperSigningCredential()  </span><br><span class="line">        .AddInMemoryApiScopes(Config.ApiScopes)</span><br><span class="line">        .AddInMemoryClients(Config.Clients);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>启动项目 导航到 <a target="_blank" rel="noopener" href="https://localhost:5001/.well-known/openid-configuration">https://localhost:5001/.well-known/openid-configuration</a></p>
</li>
<li><p>创建一个API, 并使用上面的IdentityServer作认证</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dotnet new webapi -n Api</span><br><span class="line">dotnet sln add .\Api\Api.csproj</span><br></pre></td></tr></table></figure>
<p>受保护的接口(protected interface)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[Route(&quot;identity&quot;)]</span><br><span class="line">[ApiController]</span><br><span class="line">[Authorize]</span><br><span class="line">public class IdentityController : ControllerBase</span><br><span class="line">&#123;</span><br><span class="line">    [HttpGet]</span><br><span class="line">    public IActionResult Get()</span><br><span class="line">    &#123;</span><br><span class="line">        return new JsonResult(from c in User.Claims select new &#123; c.Type, c.Value &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在startup.cs配置认证</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">public void ConfigureServices(IServiceCollection services)&#123;</span><br><span class="line">    ...</span><br><span class="line">    services.AddAuthentication(&quot;Bearer&quot;)</span><br><span class="line">    .AddJwtBearer(&quot;Bearer&quot;, options &#x3D;&gt; &#123;</span><br><span class="line">        options.Authority &#x3D; &quot;https:&#x2F;&#x2F;localhost:5001&quot;;</span><br><span class="line">        options.TokenValidationParameters &#x3D; new Microsoft.IdentityModel.Tokens.TokenValidationParameters</span><br><span class="line">        &#123;</span><br><span class="line">            ValidateAudience &#x3D; false</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public void Configure(IApplicationBuilder app, IWebHostEnvironment env)&#123;</span><br><span class="line">    ...</span><br><span class="line">    app.UseAuthentication();</span><br><span class="line">    app.UseAuthorization();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>写一个发请求的console program<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dotnet new console -n Client</span><br><span class="line">dotnet sln add .\Client\Client.csproj</span><br></pre></td></tr></table></figure>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">class Program</span><br><span class="line">&#123;</span><br><span class="line">    public static async Task Main(string[] args)</span><br><span class="line">    &#123;</span><br><span class="line">        var client &#x3D; new HttpClient();</span><br><span class="line">        var disco &#x3D; await client.GetDiscoveryDocumentAsync(&quot;https:&#x2F;&#x2F;localhost:5001&quot;);</span><br><span class="line">        if (disco.IsError)</span><br><span class="line">        &#123;</span><br><span class="line">            Console.WriteLine(disco.Error);</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line">        var tokenResponse &#x3D; await client.RequestClientCredentialsTokenAsync(new ClientCredentialsTokenRequest</span><br><span class="line">        &#123;</span><br><span class="line">            Address &#x3D; disco.TokenEndpoint,</span><br><span class="line">            ClientId &#x3D; &quot;client&quot;,</span><br><span class="line">            ClientSecret &#x3D; &quot;secret&quot;,</span><br><span class="line">            Scope &#x3D; &quot;api1&quot;</span><br><span class="line">        &#125;);;</span><br><span class="line"></span><br><span class="line">        if (tokenResponse.IsError)</span><br><span class="line">        &#123;</span><br><span class="line">            Console.WriteLine(tokenResponse.Error);</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Console.WriteLine(tokenResponse.Json);</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; call api</span><br><span class="line">        var apiClient &#x3D; new HttpClient();</span><br><span class="line">        apiClient.SetBearerToken(tokenResponse.AccessToken);</span><br><span class="line">        var response &#x3D; await apiClient.GetAsync(&quot;https:&#x2F;&#x2F;localhost:44323&#x2F;identity&quot;);</span><br><span class="line">        if (!response.IsSuccessStatusCode)</span><br><span class="line">        &#123;</span><br><span class="line">            Console.WriteLine(response.StatusCode);</span><br><span class="line">        &#125;</span><br><span class="line">        else</span><br><span class="line">        &#123;</span><br><span class="line">            var content &#x3D; await response.Content.ReadAsStringAsync();</span><br><span class="line">            Console.WriteLine(JArray.Parse(content));</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在vs中右键solution在Properties中配置Multiple startup projects，确认后开始运行(F5)<br>右键Client project —&gt; Debug —&gt; start new instance 因为控制台程序执行后关闭 在Program中打断点</p>
<ol>
<li>认证之后是授权<br>配置API使用Policy<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">public void ConfigureServices(IServiceCollection services)&#123;</span><br><span class="line">    ...</span><br><span class="line">    services.AddAuthorization(options&#x3D;&gt; &#123;</span><br><span class="line">        options.AddPolicy(&quot;ApiScope&quot;, policy &#x3D;&gt;</span><br><span class="line">        &#123;</span><br><span class="line">            policy.RequireAuthenticatedUser();</span><br><span class="line">            policy.RequireClaim(&quot;scope&quot;, &quot;api1&quot;);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line">public void Configure(IApplicationBuilder app, IWebHostEnvironment env)&#123;</span><br><span class="line">    ...</span><br><span class="line">    app.UseEndpoints(endpoints &#x3D;&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        endpoints.MapControllers()</span><br><span class="line">        .RequireAuthorization(&quot;ApiScope&quot;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
进阶：</li>
<li>以上是使用写死的id+secret通过认证，下面加入交互UI<br>创建Mvc Client<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
配置认证</li>
<li><p>配置OpenId Connect</p>
<blockquote>
<p>Similar to OAuth 2.0, OpenID Connect also uses the scopes concept. Again, scopes represent something you want to protect and that clients want to access. In contrast to OAuth, scopes in OIDC don’t represent APIs, but identity data like user id, name or email address. </p>
</blockquote>
</li>
<li><p>在Identity Server注册Mvc Client</p>
</li>
</ol>
<h4 id="使用entity-framework库保存配置以及运行中数据"><a href="#使用entity-framework库保存配置以及运行中数据" class="headerlink" title="使用entity framework库保存配置以及运行中数据"></a>使用entity framework库保存配置以及运行中数据</h4><p>官方文档中基于上述Quickstart项目扩展，使前者In Memery的配置以及运行数据可以保存到数据库<br><a href="">github上的sample</a>与使用is4ef模板生成的项目有差别<br>download sample源码 在此基础上开发自己的需求 加入IConfiguration并从appsettings.json读取connectionstring</p>
<p>源码在startup中定义了一个InitializeDatabase方法 在第一次启动时执行以初始化SQL Server数据库 之后就把它注释掉</p>
<p>将我们的client写入到数据库配置<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO [dbo].[Clients]</span><br><span class="line">           ([Enabled]</span><br><span class="line">           ,[ClientId]</span><br><span class="line">           ,[ProtocolType]</span><br><span class="line">           ,[RequireClientSecret]</span><br><span class="line">           ,[ClientName]</span><br><span class="line">           ,[Description]</span><br><span class="line">           ,[ClientUri]</span><br><span class="line">           ,[LogoUri]</span><br><span class="line">           ,[RequireConsent]</span><br><span class="line">           ,[AllowRememberConsent]</span><br><span class="line">           ,[AlwaysIncludeUserClaimsInIdToken]</span><br><span class="line">           ,[RequirePkce]</span><br><span class="line">           ,[AllowPlainTextPkce]</span><br><span class="line">           ,[RequireRequestObject]</span><br><span class="line">           ,[AllowAccessTokensViaBrowser]</span><br><span class="line">           ,[FrontChannelLogoutUri]</span><br><span class="line">           ,[FrontChannelLogoutSessionRequired]</span><br><span class="line">           ,[BackChannelLogoutUri]</span><br><span class="line">           ,[BackChannelLogoutSessionRequired]</span><br><span class="line">           ,[AllowOfflineAccess]</span><br><span class="line">           ,[IdentityTokenLifetime]</span><br><span class="line">           ,[AllowedIdentityTokenSigningAlgorithms]</span><br><span class="line">           ,[AccessTokenLifetime]</span><br><span class="line">           ,[AuthorizationCodeLifetime]</span><br><span class="line">           ,[ConsentLifetime]</span><br><span class="line">           ,[AbsoluteRefreshTokenLifetime]</span><br><span class="line">           ,[SlidingRefreshTokenLifetime]</span><br><span class="line">           ,[RefreshTokenUsage]</span><br><span class="line">           ,[UpdateAccessTokenClaimsOnRefresh]</span><br><span class="line">           ,[RefreshTokenExpiration]</span><br><span class="line">           ,[AccessTokenType]</span><br><span class="line">           ,[EnableLocalLogin]</span><br><span class="line">           ,[IncludeJwtId]</span><br><span class="line">           ,[AlwaysSendClientClaims]</span><br><span class="line">           ,[ClientClaimsPrefix]</span><br><span class="line">           ,[PairWiseSubjectSalt]</span><br><span class="line">           ,[Created]</span><br><span class="line">           ,[Updated]</span><br><span class="line">           ,[LastAccessed]</span><br><span class="line">           ,[UserSsoLifetime]</span><br><span class="line">           ,[UserCodeType]</span><br><span class="line">           ,[DeviceCodeLifetime]</span><br><span class="line">           ,[NonEditable])</span><br><span class="line">     VALUES</span><br><span class="line">           (1</span><br><span class="line">           ,&#39;angular_spa&#39;</span><br><span class="line">           ,&#39;oidc&#39;</span><br><span class="line">           ,0</span><br><span class="line">           ,null</span><br><span class="line">           ,null</span><br><span class="line">           ,null</span><br><span class="line">           ,null</span><br><span class="line">           ,0</span><br><span class="line">           ,1</span><br><span class="line">           ,0</span><br><span class="line">           ,1</span><br><span class="line">           ,0</span><br><span class="line">           ,0</span><br><span class="line">           ,0</span><br><span class="line">           ,null</span><br><span class="line">           ,1</span><br><span class="line">           ,null</span><br><span class="line">           ,1</span><br><span class="line">           ,0</span><br><span class="line">           ,300</span><br><span class="line">           ,null</span><br><span class="line">           ,3600</span><br><span class="line">           ,300</span><br><span class="line">           ,null</span><br><span class="line">           ,2592000</span><br><span class="line">           ,1296000</span><br><span class="line">           ,1</span><br><span class="line">           ,0</span><br><span class="line">           ,1</span><br><span class="line">           ,0</span><br><span class="line">           ,1</span><br><span class="line">           ,1</span><br><span class="line">           ,0</span><br><span class="line">           ,&#39;client_&#39;</span><br><span class="line">           ,null</span><br><span class="line">           ,SYSDATETIME()</span><br><span class="line">           ,null</span><br><span class="line">           ,null</span><br><span class="line">           ,null</span><br><span class="line">           ,null</span><br><span class="line">           ,300</span><br><span class="line">           ,0)</span><br></pre></td></tr></table></figure><br>写入client scope<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO [dbo].[ClientScopes]</span><br><span class="line">           ([Scope]</span><br><span class="line">           ,[ClientId])</span><br><span class="line">     VALUES</span><br><span class="line">           (&#39;openid&#39;</span><br><span class="line">           ,3);</span><br><span class="line">		   INSERT INTO [dbo].[ClientScopes]</span><br><span class="line">           ([Scope]</span><br><span class="line">           ,[ClientId])</span><br><span class="line">     VALUES</span><br><span class="line">           (&#39;profile&#39;</span><br><span class="line">           ,3);</span><br><span class="line">		   INSERT INTO [dbo].[ClientScopes]</span><br><span class="line">           ([Scope]</span><br><span class="line">           ,[ClientId])</span><br><span class="line">     VALUES</span><br><span class="line">           (&#39;api1&#39;</span><br><span class="line">           ,3)</span><br></pre></td></tr></table></figure></p>
<p>client cors配置<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO [dbo].[ClientCorsOrigins]</span><br><span class="line">           ([Origin]</span><br><span class="line">           ,[ClientId])</span><br><span class="line">     VALUES</span><br><span class="line">           (&#39;http:&#x2F;&#x2F;localhost:4200&#39;</span><br><span class="line">           ,3)</span><br></pre></td></tr></table></figure><br>到这一步 angular spa 可以完成到identity server的跳转但是显示授权错误“Sorry, there was an error : unauthorized_client<br>Unknown client or client not enabled”<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">INSERT INTO [dbo].[ClientGrantTypes]</span><br><span class="line">           ([GrantType]</span><br><span class="line">           ,[ClientId])</span><br><span class="line">     VALUES</span><br><span class="line">           (&#39;implicit&#39;</span><br><span class="line">           ,3)</span><br><span class="line">GO</span><br></pre></td></tr></table></figure><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO [dbo].[ApiResources]</span><br><span class="line">           ([Enabled]</span><br><span class="line">           ,[Name]</span><br><span class="line">           ,[DisplayName]</span><br><span class="line">           ,[Description]</span><br><span class="line">           ,[AllowedAccessTokenSigningAlgorithms]</span><br><span class="line">           ,[ShowInDiscoveryDocument]</span><br><span class="line">           ,[Created]</span><br><span class="line">           ,[Updated]</span><br><span class="line">           ,[LastAccessed]</span><br><span class="line">           ,[NonEditable])</span><br><span class="line">     VALUES</span><br><span class="line">           (1</span><br><span class="line">           ,&#39;api1&#39;</span><br><span class="line">           ,&#39;AMS API&#39;</span><br><span class="line">           ,null</span><br><span class="line">           ,null</span><br><span class="line">           ,1</span><br><span class="line">           ,SYSDATETIME()</span><br><span class="line">           ,null</span><br><span class="line">           ,null</span><br><span class="line">           ,0)</span><br><span class="line">GO</span><br></pre></td></tr></table></figure><br>安装entityframework sqlserver依赖<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dotnet add package IdentityServer4.EntityFramework</span><br><span class="line">dotnet add package Microsoft.EntityFrameworkCore.SqlServer</span><br></pre></td></tr></table></figure></p>
<p>模板使用的是sqlitedb 见startup.cs<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">services..AddConfigurationStore(options &#x3D;&gt;</span><br><span class="line">&#123;</span><br><span class="line">    options.ConfigureDbContext &#x3D; builder &#x3D;&gt; builder.UseSqlite(connectionString);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<ul>
<li>ConfigurationDbContext  - 配置数据如 clients, resources, scopes</li>
<li>PersistedGrantDbContext - 临时处理数据如 authorization codes, refresh tokens</li>
</ul>
<p>用户数据库上下文<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dotnet ef migrations add InitUserContext -c AMSIS.Data.UserContext -o Data&#x2F;Migrations&#x2F;UserDb</span><br><span class="line">Update-Database -c AMSIS.Data.UserContext</span><br></pre></td></tr></table></figure></p>
<h4 id="login-logout-workflow-和-重定向"><a href="#login-logout-workflow-和-重定向" class="headerlink" title="login/logout workflow 和 重定向"></a>login/logout workflow 和 重定向</h4><p>当token无效时（比如后台校验jwt返回前台401）前台spa应跳转至登录页如 <a target="_blank" rel="noopener" href="http://localhost:44365/account/login?returnUri=http%3A//localhost%3A4200/passport/callback">http://localhost:44365/account/login?returnUri=http%3A//localhost%3A4200/passport/callback</a></p>
<p>spa应在路由到callback时从url中取得token存localstorage</p>
<h4 id="registry-workflow"><a href="#registry-workflow" class="headerlink" title="registry workflow"></a>registry workflow</h4><p>跳转到注册页 填表单 保存profile<br>应在业务领域分离出用户/账户信息 使用从identityserver取得的openid关联本业务领域数据</p>
<h4 id="返回包含自定义Claim的Profile"><a href="#返回包含自定义Claim的Profile" class="headerlink" title="返回包含自定义Claim的Profile"></a>返回包含自定义Claim的Profile</h4><h4 id="为自己的用户体系实现认证接口"><a href="#为自己的用户体系实现认证接口" class="headerlink" title="为自己的用户体系实现认证接口"></a>为自己的用户体系实现认证接口</h4><h4 id="部署到http"><a href="#部署到http" class="headerlink" title="部署到http"></a>部署到http</h4><p><a target="_blank" rel="noopener" href="https://www.likecs.com/show-306384005.html">lax cookie policy</a></p>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/qqsnote/tags/Net/" rel="tag"># .Net</a>
              <a href="/qqsnote/tags/%E8%AE%A4%E8%AF%81-%E6%8E%88%E6%9D%83/" rel="tag"># 认证&授权</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/qqsnote/2021/09/23/DevOps-Database/" rel="prev" title="DevOps-Database">
      <i class="fa fa-chevron-left"></i> DevOps-Database
    </a></div>
      <div class="post-nav-item">
    <a href="/qqsnote/2021/10/18/Jfrog/" rel="next" title="Jfrog">
      Jfrog <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%83%8C%E6%99%AF"><span class="nav-number">1.</span> <span class="nav-text">背景</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%9C%80%E6%B1%82"><span class="nav-number">2.</span> <span class="nav-text">需求</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#is4"><span class="nav-number">3.</span> <span class="nav-text">is4</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8entity-framework%E5%BA%93%E4%BF%9D%E5%AD%98%E9%85%8D%E7%BD%AE%E4%BB%A5%E5%8F%8A%E8%BF%90%E8%A1%8C%E4%B8%AD%E6%95%B0%E6%8D%AE"><span class="nav-number">4.</span> <span class="nav-text">使用entity framework库保存配置以及运行中数据</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#login-logout-workflow-%E5%92%8C-%E9%87%8D%E5%AE%9A%E5%90%91"><span class="nav-number">5.</span> <span class="nav-text">login&#x2F;logout workflow 和 重定向</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#registry-workflow"><span class="nav-number">6.</span> <span class="nav-text">registry workflow</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%BF%94%E5%9B%9E%E5%8C%85%E5%90%AB%E8%87%AA%E5%AE%9A%E4%B9%89Claim%E7%9A%84Profile"><span class="nav-number">7.</span> <span class="nav-text">返回包含自定义Claim的Profile</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%BA%E8%87%AA%E5%B7%B1%E7%9A%84%E7%94%A8%E6%88%B7%E4%BD%93%E7%B3%BB%E5%AE%9E%E7%8E%B0%E8%AE%A4%E8%AF%81%E6%8E%A5%E5%8F%A3"><span class="nav-number">8.</span> <span class="nav-text">为自己的用户体系实现认证接口</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%83%A8%E7%BD%B2%E5%88%B0http"><span class="nav-number">9.</span> <span class="nav-text">部署到http</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">QQs</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/qqsnote/archives/">
        
          <span class="site-state-item-count">336</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/qqsnote/categories/">
        <span class="site-state-item-count">21</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/qqsnote/tags/">
        <span class="site-state-item-count">128</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



      </div>

      <div class="tag-cloud-tags">
        <a href="/qqsnote/tags/Net/" style="font-size: 30px; color: #fff">.Net</a> <a href="/qqsnote/tags/4G/" style="font-size: 12px; color: #ccc">4G</a> <a href="/qqsnote/tags/AI/" style="font-size: 22.5px; color: #eaeaea">AI</a> <a href="/qqsnote/tags/Android/" style="font-size: 12px; color: #ccc">Android</a> <a href="/qqsnote/tags/Angular/" style="font-size: 30px; color: #fff">Angular</a> <a href="/qqsnote/tags/Apache/" style="font-size: 13.5px; color: #d0d0d0">Apache</a> <a href="/qqsnote/tags/Azure/" style="font-size: 25.5px; color: #f2f2f2">Azure</a> <a href="/qqsnote/tags/Babylon/" style="font-size: 12px; color: #ccc">Babylon</a> <a href="/qqsnote/tags/C/" style="font-size: 16.5px; color: #d9d9d9">C#</a> <a href="/qqsnote/tags/C/" style="font-size: 16.5px; color: #d9d9d9">C++</a> <a href="/qqsnote/tags/CSS/" style="font-size: 19.5px; color: #e1e1e1">CSS</a> <a href="/qqsnote/tags/DevOps/" style="font-size: 15px; color: #d5d5d5">DevOps</a> <a href="/qqsnote/tags/Docker/" style="font-size: 16.5px; color: #d9d9d9">Docker</a> <a href="/qqsnote/tags/ES6/" style="font-size: 12px; color: #ccc">ES6</a> <a href="/qqsnote/tags/ESLint/" style="font-size: 12px; color: #ccc">ESLint</a> <a href="/qqsnote/tags/ElasticSearch/" style="font-size: 12px; color: #ccc">ElasticSearch</a> <a href="/qqsnote/tags/Electron/" style="font-size: 16.5px; color: #d9d9d9">Electron</a> <a href="/qqsnote/tags/ElementUI/" style="font-size: 12px; color: #ccc">ElementUI</a> <a href="/qqsnote/tags/EntityFramework/" style="font-size: 13.5px; color: #d0d0d0">EntityFramework</a> <a href="/qqsnote/tags/EventBus/" style="font-size: 12px; color: #ccc">EventBus</a> <a href="/qqsnote/tags/Excel/" style="font-size: 12px; color: #ccc">Excel</a> <a href="/qqsnote/tags/FastDFS/" style="font-size: 12px; color: #ccc">FastDFS</a> <a href="/qqsnote/tags/Figma/" style="font-size: 12px; color: #ccc">Figma</a> <a href="/qqsnote/tags/Go/" style="font-size: 12px; color: #ccc">Go</a> <a href="/qqsnote/tags/GraphQL/" style="font-size: 12px; color: #ccc">GraphQL</a> <a href="/qqsnote/tags/Jasmine/" style="font-size: 12px; color: #ccc">Jasmine</a> <a href="/qqsnote/tags/Java/" style="font-size: 13.5px; color: #d0d0d0">Java</a> <a href="/qqsnote/tags/Jenkins/" style="font-size: 21px; color: #e6e6e6">Jenkins</a> <a href="/qqsnote/tags/Linux/" style="font-size: 22.5px; color: #eaeaea">Linux</a> <a href="/qqsnote/tags/MQ/" style="font-size: 12px; color: #ccc">MQ</a> <a href="/qqsnote/tags/Markdown/" style="font-size: 13.5px; color: #d0d0d0">Markdown</a> <a href="/qqsnote/tags/MongoDB/" style="font-size: 12px; color: #ccc">MongoDB</a> <a href="/qqsnote/tags/Monorepo/" style="font-size: 12px; color: #ccc">Monorepo</a> <a href="/qqsnote/tags/MySQL/" style="font-size: 12px; color: #ccc">MySQL</a> <a href="/qqsnote/tags/NSIS/" style="font-size: 12px; color: #ccc">NSIS</a> <a href="/qqsnote/tags/Nginx/" style="font-size: 12px; color: #ccc">Nginx</a> <a href="/qqsnote/tags/NoSQL/" style="font-size: 12px; color: #ccc">NoSQL</a> <a href="/qqsnote/tags/Node-js/" style="font-size: 18px; color: #ddd">Node.js</a> <a href="/qqsnote/tags/OData/" style="font-size: 13.5px; color: #d0d0d0">OData</a> <a href="/qqsnote/tags/OpenCV/" style="font-size: 18px; color: #ddd">OpenCV</a> <a href="/qqsnote/tags/OpenGL/" style="font-size: 13.5px; color: #d0d0d0">OpenGL</a> <a href="/qqsnote/tags/PHP/" style="font-size: 12px; color: #ccc">PHP</a> <a href="/qqsnote/tags/PWA/" style="font-size: 12px; color: #ccc">PWA</a> <a href="/qqsnote/tags/PyCharm/" style="font-size: 12px; color: #ccc">PyCharm</a> <a href="/qqsnote/tags/Python/" style="font-size: 24px; color: #eee">Python</a> <a href="/qqsnote/tags/R3F/" style="font-size: 12px; color: #ccc">R3F</a> <a href="/qqsnote/tags/React/" style="font-size: 21px; color: #e6e6e6">React</a> <a href="/qqsnote/tags/SQL/" style="font-size: 12px; color: #ccc">SQL</a> <a href="/qqsnote/tags/SQL-Server/" style="font-size: 15px; color: #d5d5d5">SQL_Server</a> <a href="/qqsnote/tags/ServiceWorker/" style="font-size: 12px; color: #ccc">ServiceWorker</a> <a href="/qqsnote/tags/Shell/" style="font-size: 12px; color: #ccc">Shell</a> <a href="/qqsnote/tags/Three-js/" style="font-size: 16.5px; color: #d9d9d9">Three.js</a> <a href="/qqsnote/tags/TypeScript/" style="font-size: 13.5px; color: #d0d0d0">TypeScript</a> <a href="/qqsnote/tags/UE/" style="font-size: 12px; color: #ccc">UE</a> <a href="/qqsnote/tags/UI/" style="font-size: 12px; color: #ccc">UI</a> <a href="/qqsnote/tags/UML/" style="font-size: 12px; color: #ccc">UML</a> <a href="/qqsnote/tags/Virtualbox/" style="font-size: 12px; color: #ccc">Virtualbox</a> <a href="/qqsnote/tags/WPF/" style="font-size: 12px; color: #ccc">WPF</a> <a href="/qqsnote/tags/WebGL/" style="font-size: 21px; color: #e6e6e6">WebGL</a> <a href="/qqsnote/tags/WebService/" style="font-size: 12px; color: #ccc">WebService</a> <a href="/qqsnote/tags/Web%E5%8D%8F%E8%AE%AE/" style="font-size: 12px; color: #ccc">Web协议</a> <a href="/qqsnote/tags/Web%E5%BC%80%E5%8F%91/" style="font-size: 27px; color: #f7f7f7">Web开发</a> <a href="/qqsnote/tags/Wechat/" style="font-size: 12px; color: #ccc">Wechat</a> <a href="/qqsnote/tags/aigc/" style="font-size: 12px; color: #ccc">aigc</a> <a href="/qqsnote/tags/auth/" style="font-size: 12px; color: #ccc">auth</a> <a href="/qqsnote/tags/axios/" style="font-size: 12px; color: #ccc">axios</a> <a href="/qqsnote/tags/canvas/" style="font-size: 12px; color: #ccc">canvas</a> <a href="/qqsnote/tags/css/" style="font-size: 12px; color: #ccc">css</a> <a href="/qqsnote/tags/express/" style="font-size: 12px; color: #ccc">express</a> <a href="/qqsnote/tags/ftp/" style="font-size: 12px; color: #ccc">ftp</a> <a href="/qqsnote/tags/git/" style="font-size: 13.5px; color: #d0d0d0">git</a> <a href="/qqsnote/tags/hexo/" style="font-size: 12px; color: #ccc">hexo</a> <a href="/qqsnote/tags/http/" style="font-size: 12px; color: #ccc">http</a> <a href="/qqsnote/tags/http2/" style="font-size: 12px; color: #ccc">http2</a> <a href="/qqsnote/tags/https/" style="font-size: 12px; color: #ccc">https</a> <a href="/qqsnote/tags/ionic/" style="font-size: 12px; color: #ccc">ionic</a> <a href="/qqsnote/tags/javascript/" style="font-size: 28.5px; color: #fbfbfb">javascript</a> <a href="/qqsnote/tags/k8s/" style="font-size: 12px; color: #ccc">k8s</a> <a href="/qqsnote/tags/login/" style="font-size: 12px; color: #ccc">login</a> <a href="/qqsnote/tags/loopback/" style="font-size: 12px; color: #ccc">loopback</a> <a href="/qqsnote/tags/ngrok/" style="font-size: 12px; color: #ccc">ngrok</a> <a href="/qqsnote/tags/npm/" style="font-size: 12px; color: #ccc">npm</a> <a href="/qqsnote/tags/nsis/" style="font-size: 13.5px; color: #d0d0d0">nsis</a> <a href="/qqsnote/tags/redis/" style="font-size: 12px; color: #ccc">redis</a> <a href="/qqsnote/tags/sqlServer/" style="font-size: 12px; color: #ccc">sqlServer</a> <a href="/qqsnote/tags/ssh/" style="font-size: 12px; color: #ccc">ssh</a> <a href="/qqsnote/tags/svg/" style="font-size: 12px; color: #ccc">svg</a> <a href="/qqsnote/tags/trea/" style="font-size: 12px; color: #ccc">trea</a> <a href="/qqsnote/tags/vtk/" style="font-size: 16.5px; color: #d9d9d9">vtk</a> <a href="/qqsnote/tags/vuejs/" style="font-size: 19.5px; color: #e1e1e1">vuejs</a> <a href="/qqsnote/tags/webassembly/" style="font-size: 15px; color: #d5d5d5">webassembly</a> <a href="/qqsnote/tags/webpack/" style="font-size: 12px; color: #ccc">webpack</a> <a href="/qqsnote/tags/websocket/" style="font-size: 12px; color: #ccc">websocket</a> <a href="/qqsnote/tags/windows/" style="font-size: 12px; color: #ccc">windows</a> <a href="/qqsnote/tags/yarn/" style="font-size: 12px; color: #ccc">yarn</a> <a href="/qqsnote/tags/%E4%B8%8A%E4%BC%A0/" style="font-size: 12px; color: #ccc">上传</a> <a href="/qqsnote/tags/%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/" style="font-size: 12px; color: #ccc">内网穿透</a> <a href="/qqsnote/tags/%E5%8A%A0%E5%AF%86/" style="font-size: 16.5px; color: #d9d9d9">加密</a> <a href="/qqsnote/tags/%E5%8C%BB%E5%AD%A6%E5%9B%BE%E5%83%8F/" style="font-size: 13.5px; color: #d0d0d0">医学图像</a> <a href="/qqsnote/tags/%E5%8D%9A%E5%BC%88%E8%AE%BA/" style="font-size: 12px; color: #ccc">博弈论</a> <a href="/qqsnote/tags/%E5%9B%BE%E5%83%8F%E5%A4%84%E7%90%86/" style="font-size: 12px; color: #ccc">图像处理</a> <a href="/qqsnote/tags/%E5%9B%BE%E5%BD%A2%E5%AD%A6/" style="font-size: 18px; color: #ddd">图形学</a> <a href="/qqsnote/tags/%E5%A4%9A%E8%AF%AD%E8%A8%80/" style="font-size: 13.5px; color: #d0d0d0">多语言</a> <a href="/qqsnote/tags/%E5%A4%A7%E6%A8%A1%E5%9E%8B/" style="font-size: 12px; color: #ccc">大模型</a> <a href="/qqsnote/tags/%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B/" style="font-size: 12px; color: #ccc">存储过程</a> <a href="/qqsnote/tags/%E6%80%A7%E8%83%BD/" style="font-size: 15px; color: #d5d5d5">性能</a> <a href="/qqsnote/tags/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/" style="font-size: 13.5px; color: #d0d0d0">性能优化</a> <a href="/qqsnote/tags/%E6%88%90%E9%95%BF%E6%80%9D%E7%BB%B4/" style="font-size: 12px; color: #ccc">成长思维</a> <a href="/qqsnote/tags/%E6%91%84%E5%BD%B1/" style="font-size: 12px; color: #ccc">摄影</a> <a href="/qqsnote/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" style="font-size: 12px; color: #ccc">操作系统</a> <a href="/qqsnote/tags/%E6%95%B0%E5%AD%97%E7%AD%BE%E5%90%8D/" style="font-size: 12px; color: #ccc">数字签名</a> <a href="/qqsnote/tags/%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96/" style="font-size: 12px; color: #ccc">数据可视化</a> <a href="/qqsnote/tags/%E6%95%B0%E6%8D%AE%E5%BA%93%E9%94%81/" style="font-size: 12px; color: #ccc">数据库锁</a> <a href="/qqsnote/tags/%E6%A0%91%E8%8E%93%E6%B4%BE/" style="font-size: 12px; color: #ccc">树莓派</a> <a href="/qqsnote/tags/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/" style="font-size: 12px; color: #ccc">正则表达式</a> <a href="/qqsnote/tags/%E7%89%A9%E8%81%94%E7%BD%91/" style="font-size: 12px; color: #ccc">物联网</a> <a href="/qqsnote/tags/%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F/" style="font-size: 13.5px; color: #d0d0d0">环境变量</a> <a href="/qqsnote/tags/%E7%AE%97%E6%B3%95/" style="font-size: 16.5px; color: #d9d9d9">算法</a> <a href="/qqsnote/tags/%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/" style="font-size: 12px; color: #ccc">编码规范</a> <a href="/qqsnote/tags/%E8%8B%B1%E8%AF%AD/" style="font-size: 12px; color: #ccc">英语</a> <a href="/qqsnote/tags/%E8%A7%86%E9%A2%91%E6%B5%81/" style="font-size: 12px; color: #ccc">视频流</a> <a href="/qqsnote/tags/%E8%A7%A6%E5%8F%91%E5%99%A8/" style="font-size: 12px; color: #ccc">触发器</a> <a href="/qqsnote/tags/%E8%AE%A4%E8%AF%81-%E6%8E%88%E6%9D%83/" style="font-size: 21px; color: #e6e6e6">认证&授权</a> <a href="/qqsnote/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" style="font-size: 12px; color: #ccc">设计模式</a> <a href="/qqsnote/tags/%E8%AF%BB%E4%B9%A6/" style="font-size: 12px; color: #ccc">读书</a> <a href="/qqsnote/tags/%E8%BF%9B%E7%A8%8B%E5%AE%88%E6%8A%A4/" style="font-size: 12px; color: #ccc">进程守护</a> <a href="/qqsnote/tags/%E9%9D%A2%E8%AF%95/" style="font-size: 13.5px; color: #d0d0d0">面试</a> <a href="/qqsnote/tags/%E9%A6%99%E6%A9%99%E6%B4%BE/" style="font-size: 12px; color: #ccc">香橙派</a>
      </div>
    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">QQs</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/qqsnote/lib/anime.min.js"></script>
  <script src="/qqsnote/lib/velocity/velocity.min.js"></script>
  <script src="/qqsnote/lib/velocity/velocity.ui.min.js"></script>

<script src="/qqsnote/js/utils.js"></script>

<script src="/qqsnote/js/motion.js"></script>


<script src="/qqsnote/js/schemes/muse.js"></script>


<script src="/qqsnote/js/next-boot.js"></script>




  




  
<script src="/qqsnote/js/local-search.js"></script>













  

  

  

</body>
</html>
