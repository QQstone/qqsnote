<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/qqsnote/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/qqsnote/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/qqsnote/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/qqsnote/images/logo.svg" color="#222">

<link rel="stylesheet" href="/qqsnote/css/main.css">


<link rel="stylesheet" href="/qqsnote/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"qqstone.github.io","root":"/qqsnote/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.json"};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="QQs&#39;Note">
<meta property="og:url" content="http://qqstone.github.io/qqsnote/page/23/index.html">
<meta property="og:site_name" content="QQs&#39;Note">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="QQs">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://qqstone.github.io/qqsnote/page/23/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>QQs'Note</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/qqsnote/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">QQs'Note</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/qqsnote/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/qqsnote/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://qqstone.github.io/qqsnote/2020/05/09/dotNetCore-Authentication/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/qqsnote/images/avatar.gif">
      <meta itemprop="name" content="QQs">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="QQs'Note">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/qqsnote/2020/05/09/dotNetCore-Authentication/" class="post-title-link" itemprop="url">.Net Core Authentication & Authorization</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-05-09 14:09:38" itemprop="dateCreated datePublished" datetime="2020-05-09T14:09:38+08:00">2020-05-09</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-07-05 10:07:52" itemprop="dateModified" datetime="2025-07-05T10:07:52+08:00">2025-07-05</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h4 id="关于认证"><a href="#关于认证" class="headerlink" title="关于认证"></a>关于认证</h4><p>参考<a target="_blank" rel="noopener" href="https://www.cnblogs.com/savorboard/p/aspnetcore-authentication.html">ASP.NET Core 中的那些认证中间件及一些重要知识点</a></p>
<blockquote>
<p>在 <span>ASP.NET</span> Core 中，身份验证由 IAuthenticationService 负责，而它供身份验证中间件使用。</p>
</blockquote>
<p>身份验证中间件</p>
<blockquote>
<p>已注册的身份验证处理程序及其配置选项被称为“方案（schema）”。</p>
<p>Authentication schemes are specified by registering authentication services in Startup.ConfigureServices:<br>在startup.cs的ConfigureServices中通过注册身份认证，指定认证方案<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">public void ConfigureServices(IServiceCollection services)&#123;</span><br><span class="line">    services.AddAuthentication(&quot;YourSchemaName&quot;)</span><br><span class="line">    .AddJwtBearer(JwtBearerDefaults.AuthenticationScheme, options &#x3D;&gt; Configuration.Bind(&quot;JwtSettings&quot;, options))</span><br><span class="line">    .AddCookie(CookieAuthenticationDefaults.AuthenticationScheme, options &#x3D;&gt; Configuration.Bind(&quot;CookieSettings&quot;, options));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>AddAuthentication的参数是方案名称，默认值为JwtBearerDefaults.AuthenticationScheme(即”Bearer”)。</p>
</blockquote>
<p>可使用多种身份验证方案<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">public void ConfigureServices(IServiceCollection services)</span><br><span class="line">&#123;</span><br><span class="line">    &#x2F;&#x2F; 认证方案</span><br><span class="line"></span><br><span class="line">    services.AddAuthentication(JwtBearerDefaults.AuthenticationScheme)</span><br><span class="line">        .AddJwtBearer(options &#x3D;&gt;</span><br><span class="line">        &#123;</span><br><span class="line">            options.Audience &#x3D; &quot;https:&#x2F;&#x2F;localhost:5000&#x2F;&quot;;</span><br><span class="line">            options.Authority &#x3D; &quot;https:&#x2F;&#x2F;localhost:5000&#x2F;identity&#x2F;&quot;;</span><br><span class="line">        &#125;)</span><br><span class="line">        .AddJwtBearer(&quot;AzureAD&quot;, options &#x3D;&gt;</span><br><span class="line">        &#123;</span><br><span class="line">            options.Audience &#x3D; &quot;https:&#x2F;&#x2F;localhost:5000&#x2F;&quot;;</span><br><span class="line">            options.Authority &#x3D; &quot;https:&#x2F;&#x2F;login.microsoftonline.com&#x2F;eb971100-6f99-4bdc-8611-1bc8edd7f436&#x2F;&quot;;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; 授权访问</span><br><span class="line">    services.AddAuthorization(options &#x3D;&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        var defaultAuthorizationPolicyBuilder &#x3D; new AuthorizationPolicyBuilder(</span><br><span class="line">            JwtBearerDefaults.AuthenticationScheme,</span><br><span class="line">            &quot;AzureAD&quot;);</span><br><span class="line">        defaultAuthorizationPolicyBuilder &#x3D; </span><br><span class="line">            defaultAuthorizationPolicyBuilder.RequireAuthenticatedUser();</span><br><span class="line">        options.DefaultPolicy &#x3D; defaultAuthorizationPolicyBuilder.Build();</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>再说方案名称（AuthenticationScheme），可使用方案名称来指定应使用哪种（或哪些）身份验证方案来对用户进行身份验证。 当配置身份验证时，通常是指定默认身份验证方案。除非资源请求了特定方案，否则使用默认方案。</p>
<p>授权策略（authorization policy）<br>下文中有使用特性注解为资源（如api）指定授权方案的栗子<br><a target="_blank" rel="noopener" href="https://github.com/dotnet/AspNetCore/tree/release/3.1/src/Security/samples/CustomPolicyProvider">自定义策略提供程序-IAuthorizationPolicyProvider</a></p>
<p>文章<a target="_blank" rel="noopener" href="https://jasonwatmore.com/post/2018/09/08/aspnet-core-21-basic-authentication-tutorial-with-example-api">Asp.Net Basic Authentication</a>自定义了使用Basic Auth进行认证的方案，配置方案如<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">services.AddAuthentication(&quot;BasicAuthentication&quot;)</span><br><span class="line">    .AddScheme&lt;AuthenticationSchemeOptions, BasicAuthenticationHandler&gt;(&quot;BasicAuthentication&quot;, null);</span><br></pre></td></tr></table></figure></p>
<p>BasicAuthenticationHandler是自定义的身份验证处理类，派生自AuthenticationHandler\<TOptions\><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">public class BasicAuthenticationHandler : AuthenticationHandler&lt;AuthenticationSchemeOptions&gt;</span><br><span class="line">&#123;</span><br><span class="line">    private readonly IUserService _userService;</span><br><span class="line"></span><br><span class="line">    public BasicAuthenticationHandler(</span><br><span class="line">        IOptionsMonitor&lt;AuthenticationSchemeOptions&gt; options,</span><br><span class="line">        ILoggerFactory logger,</span><br><span class="line">        UrlEncoder encoder,</span><br><span class="line">        ISystemClock clock,</span><br><span class="line">        IUserService userService)</span><br><span class="line">        : base(options, logger, encoder, clock)</span><br><span class="line">    &#123;</span><br><span class="line">        _userService &#x3D; userService;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    protected override async Task&lt;AuthenticateResult&gt; HandleAuthenticateAsync()</span><br><span class="line">    &#123;</span><br><span class="line">        if (!Request.Headers.ContainsKey(&quot;Authorization&quot;))</span><br><span class="line">            return AuthenticateResult.Fail(&quot;Missing Authorization Header&quot;);</span><br><span class="line"></span><br><span class="line">        User user &#x3D; null;</span><br><span class="line">        try</span><br><span class="line">        &#123;</span><br><span class="line">            var authHeader &#x3D; AuthenticationHeaderValue.Parse(Request.Headers[&quot;Authorization&quot;]);</span><br><span class="line">            var credentialBytes &#x3D; Convert.FromBase64String(authHeader.Parameter);</span><br><span class="line">            var credentials &#x3D; Encoding.UTF8.GetString(credentialBytes).Split(new[] &#123; &#39;:&#39; &#125;, 2);</span><br><span class="line">            var username &#x3D; credentials[0];</span><br><span class="line">            var password &#x3D; credentials[1];</span><br><span class="line">            user &#x3D; await _userService.Authenticate(username, password);</span><br><span class="line">        &#125;</span><br><span class="line">        catch</span><br><span class="line">        &#123;</span><br><span class="line">            return AuthenticateResult.Fail(&quot;Invalid Authorization Header&quot;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        if (user &#x3D;&#x3D; null)</span><br><span class="line">            return AuthenticateResult.Fail(&quot;Invalid Username or Password&quot;);</span><br><span class="line"></span><br><span class="line">        var claims &#x3D; new[] &#123;</span><br><span class="line">            new Claim(ClaimTypes.NameIdentifier, user.Id.ToString()),</span><br><span class="line">            new Claim(ClaimTypes.Name, user.Username),</span><br><span class="line">        &#125;;</span><br><span class="line">        var identity &#x3D; new ClaimsIdentity(claims, Scheme.Name);</span><br><span class="line">        var principal &#x3D; new ClaimsPrincipal(identity);</span><br><span class="line">        var ticket &#x3D; new AuthenticationTicket(principal, Scheme.Name);</span><br><span class="line"></span><br><span class="line">        return AuthenticateResult.Success(ticket);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>类型定义身份验证操作，负责根据请求上下文构造用户的身份。 返回一个 AuthenticateResult指示身份验证是否成功</p>
<h4 id="选择具有策略的方案"><a href="#选择具有策略的方案" class="headerlink" title="选择具有策略的方案"></a>选择具有策略的方案</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">.AddJwtBearer(JwtBearerDefaults.AuthenticationScheme, options &#x3D;&gt; Configuration.Bind(&quot;JwtSettings&quot;, options))</span><br><span class="line">    .AddCookie(CookieAuthenticationDefaults.AuthenticationScheme, options &#x3D;&gt; Configuration.Bind(&quot;CookieSettings&quot;, options));</span><br></pre></td></tr></table></figure>
<blockquote>
<p>ASP.NET Core 中的授权通过 AuthorizeAttribute 和其各种参数来控制。 在最简单的形式中，将 [Authorize] 属性应用于控制器、操作或 Razor 页面，将对该组件的访问限制为任何经过身份验证的用户。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">namespace QQsServices.Controllers</span><br><span class="line">&#123;</span><br><span class="line">    [Authorize]</span><br><span class="line">    [Route(&quot;api&#x2F;v1&#x2F;[controller]&quot;)]</span><br><span class="line">    [ApiController]</span><br><span class="line">    public class UserController : ControllerBase</span><br><span class="line">    &#123;</span><br><span class="line">        ......</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>允许未通过验证的访问—AllowAnonymous<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[Authorize]</span><br><span class="line">public class AccountController : Controller</span><br><span class="line">&#123;</span><br><span class="line">    [AllowAnonymous]</span><br><span class="line">    public ActionResult Login()</span><br><span class="line">    &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public ActionResult Logout()</span><br><span class="line">    &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>Authorize从controller到action向下继承，而AllowAnonymous覆盖Authorize(AllowAnonymous优先级高于Authorize)</p>
<h4 id="JwtBearer"><a href="#JwtBearer" class="headerlink" title="JwtBearer"></a>JwtBearer</h4><p>持有者身份验证</p>
<h4 id="Basic-Auth"><a href="#Basic-Auth" class="headerlink" title="Basic Auth"></a>Basic Auth</h4></blockquote>
<h4 id="Cors"><a href="#Cors" class="headerlink" title="Cors"></a>Cors</h4><h4 id="基于策略的授权"><a href="#基于策略的授权" class="headerlink" title="基于策略的授权"></a>基于策略的授权</h4><p>startup.cs<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">public void ConfigureServices(IServiceCollection services)</span><br><span class="line">&#123;</span><br><span class="line">    services.AddControllersWithViews();</span><br><span class="line">    services.AddRazorPages();</span><br><span class="line">    services.AddAuthorization(options &#x3D;&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        options.AddPolicy(&quot;PolicyBased01&quot;, policy &#x3D;&gt;</span><br><span class="line">            policy.Requirements.Add(new MinimumAgeRequirement(21)));</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="指定特定授权方案"><a href="#指定特定授权方案" class="headerlink" title="指定特定授权方案"></a>指定特定授权方案</h4><p>参考 <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/aspnet/core/security/authorization/limitingidentitybyscheme?view=aspnetcore-3.1">Authorize with a specific scheme in ASP.NET Core</a></p>
<blockquote>
<p>An authentication scheme is named when the authentication service is configured during authentication. Startup的服务配置中, AddAuthentication后添加方案<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">public void ConfigureServices(IServiceCollection services)</span><br><span class="line">&#123;</span><br><span class="line">    &#x2F;&#x2F; Code omitted for brevity</span><br><span class="line"></span><br><span class="line">    services.AddAuthentication()</span><br><span class="line">        .AddCookie(options &#x3D;&gt; &#123;</span><br><span class="line">            options.LoginPath &#x3D; &quot;&#x2F;Account&#x2F;Unauthorized&#x2F;&quot;;</span><br><span class="line">            options.AccessDeniedPath &#x3D; &quot;&#x2F;Account&#x2F;Forbidden&#x2F;&quot;;</span><br><span class="line">        &#125;)</span><br><span class="line">        .AddJwtBearer(options &#x3D;&gt; &#123;</span><br><span class="line">            options.Audience &#x3D; &quot;http:&#x2F;&#x2F;localhost:5001&#x2F;&quot;;</span><br><span class="line">            options.Authority &#x3D; &quot;http:&#x2F;&#x2F;localhost:5000&#x2F;&quot;;</span><br><span class="line">        &#125;);</span><br><span class="line">    ....</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>使用授权属性选择方案<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[Authorize(AuthenticationSchemes &#x3D; JwtBearerDefaults.AuthenticationScheme)]</span><br><span class="line">public class MixedController : Controller</span><br><span class="line">.....</span><br></pre></td></tr></table></figure><br>使用策略并指定授权方案<br>If you prefer to specify the desired schemes in policy, you can set the AuthenticationSchemes collection when adding your policy. 添加授权策略时设置AuthenticationSchemes列表，将对应的scheme添加进去<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">services.AddAuthorization(options &#x3D;&gt;</span><br><span class="line">&#123;</span><br><span class="line">    options.AddPolicy(&quot;Over18&quot;, policy &#x3D;&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        policy.AuthenticationSchemes.Add(JwtBearerDefaults.AuthenticationScheme);</span><br><span class="line">        policy.RequireAuthenticatedUser();</span><br><span class="line">        policy.Requirements.Add(new MinimumAgeRequirement());</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><br>在属性中使用指定策略<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[Authorize(Policy &#x3D; &quot;Over18&quot;)]</span><br><span class="line">public class RegistrationController : Controller</span><br></pre></td></tr></table></figure><br>使用多种方案<br><br>the following code in Startup.ConfigureServices adds two JWT bearer authentication schemes with different issuers:颁发者不同的两种JWT Bearer认证方案<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">public void ConfigureServices(IServiceCollection services)</span><br><span class="line">&#123;</span><br><span class="line">    &#x2F;&#x2F; Code omitted for brevity</span><br><span class="line"></span><br><span class="line">    services.AddAuthentication(JwtBearerDefaults.AuthenticationScheme)</span><br><span class="line">        .AddJwtBearer(options &#x3D;&gt;</span><br><span class="line">        &#123;</span><br><span class="line">            options.Audience &#x3D; &quot;https:&#x2F;&#x2F;localhost:5000&#x2F;&quot;;</span><br><span class="line">            options.Authority &#x3D; &quot;https:&#x2F;&#x2F;localhost:5000&#x2F;identity&#x2F;&quot;;</span><br><span class="line">        &#125;)</span><br><span class="line">        .AddJwtBearer(&quot;AzureAD&quot;, options &#x3D;&gt;</span><br><span class="line">        &#123;</span><br><span class="line">            options.Audience &#x3D; &quot;https:&#x2F;&#x2F;localhost:5000&#x2F;&quot;;</span><br><span class="line">            options.Authority &#x3D; &quot;https:&#x2F;&#x2F;login.microsoftonline.com&#x2F;eb971100-6f99-4bdc-8611-1bc8edd7f436&#x2F;&quot;;</span><br><span class="line">        &#125;);</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>更新授权策略, 上面两种JWTBearer认证方案，将一个要注册到默认认证方案“JwtBearerDefaults.AuthenticationScheme”，另外的认证方案需要以唯一的方案注册（Only one JWT bearer authentication is registered with the default authentication scheme JwtBearerDefaults.AuthenticationScheme. Additional authentication has to be registered with a unique authentication scheme.）<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">public void ConfigureServices(IServiceCollection services)</span><br><span class="line">&#123;</span><br><span class="line">    &#x2F;&#x2F; Code omitted for brevity</span><br><span class="line"></span><br><span class="line">    services.AddAuthorization(options &#x3D;&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        var defaultAuthorizationPolicyBuilder &#x3D; new AuthorizationPolicyBuilder(</span><br><span class="line">            JwtBearerDefaults.AuthenticationScheme,</span><br><span class="line">            &quot;AzureAD&quot;);</span><br><span class="line">        defaultAuthorizationPolicyBuilder &#x3D; </span><br><span class="line">            defaultAuthorizationPolicyBuilder.RequireAuthenticatedUser();</span><br><span class="line">        options.DefaultPolicy &#x3D; defaultAuthorizationPolicyBuilder.Build();</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
</blockquote>
<p>参考<a target="_blank" rel="noopener" href="https://docs.microsoft.com/zh-cn/aspnet/core/security/authorization/iauthorizationpolicyprovider?view=aspnetcore-3.1">在 ASP.NET Core 中使用 IAuthorizationPolicyProvider 的自定义授权策略提供程序</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://qqstone.github.io/qqsnote/2020/05/09/dotNetCore-startup/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/qqsnote/images/avatar.gif">
      <meta itemprop="name" content="QQs">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="QQs'Note">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/qqsnote/2020/05/09/dotNetCore-startup/" class="post-title-link" itemprop="url">.Net Core 入坑</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-05-09 13:40:00" itemprop="dateCreated datePublished" datetime="2020-05-09T13:40:00+08:00">2020-05-09</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-07-05 10:07:52" itemprop="dateModified" datetime="2025-07-05T10:07:52+08:00">2025-07-05</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/qqsnote/categories/%E5%90%8E%E7%AB%AF%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index"><span itemprop="name">后端技术</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h4 id="net-core"><a href="#net-core" class="headerlink" title=".net core"></a>.net core</h4><blockquote>
<p><a target="_blank" rel="noopener" href="https://docs.microsoft.com/zh-cn/dotnet/core/introduction">.NET Core</a> 是一个通用的开放源代码开发平台。 可以使用多种编程语言针对 x64、x86、ARM32 和 ARM64 处理器创建适用于 Windows、macOS 和 Linux 的 .NET Core 应用。 为云、IoT、客户端 UI 和机器学习提供了框架和 API。</p>
</blockquote>
<ul>
<li>运行时和SDK<br>运行 .NET Core 应用，需安装 .NET Core 运行时。<br>创建 .NET Core 应用，需安装 .NET Core SDK。</li>
<li><p>命令行工具<br>在命令行键入dotnet —help 文章<a href="/qqsnote/2020/08/31/ASPandSPA/" title="ASP和SPA">ASP和SPA</a>有所应用。</p>
<p>另，代码生成器（<a target="_blank" rel="noopener" href="https://codesmith.atlassian.net/wiki">codesmith generator studio</a>） 和<a target="_blank" rel="noopener" href="https://codesmith.atlassian.net/wiki/spaces/NHibernate/pages/529104/Getting+Started">Nhibernate Template</a> 根据数据库表生成实体类及MVC分层结构</p>
</li>
<li>NuGet<br>包管理工具，用于安装依赖NuGet包或用于安装模板</li>
</ul>
<h4 id="asp-net-core"><a href="#asp-net-core" class="headerlink" title="asp.net core"></a><code>asp.net core</code></h4><p>  经典的 .net mvc 分层：<br><br>  view controller model<br><br>  asp.net (asp, Active Server Pages 动态服务器页面):<br></p>
<h4 id="路由"><a href="#路由" class="headerlink" title="路由"></a>路由</h4><p>  模型绑定<br>  模型验证<br>  依赖关系注入<br>  筛选器<br>  Areas<br>  <a target="_blank" rel="noopener" href="https://docs.microsoft.com/zh-cn/aspnet/core/tutorials/first-web-api?view=aspnetcore-5.0&amp;tabs=visual-studio">Web API</a><br>  Testability<br>  Razor查看引擎<br>  强类型视图<br>  标记帮助程序<br>  查看组件</p>
<h4 id="Program-cs"><a href="#Program-cs" class="headerlink" title="Program.cs"></a>Program.cs</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">public class Program</span><br><span class="line">&#123;</span><br><span class="line">    public static void Main(string[] args)</span><br><span class="line">    &#123;</span><br><span class="line">        CreateHostBuilder(args).Build().Run();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static IHostBuilder CreateHostBuilder(string[] args) &#x3D;&gt;</span><br><span class="line">        Host.CreateDefaultBuilder(args)</span><br><span class="line">            .ConfigureWebHostDefaults(webBuilder &#x3D;&gt;</span><br><span class="line">            &#123;</span><br><span class="line">                webBuilder.UseStartup&lt;Startup&gt;();</span><br><span class="line">            &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Host(宿主)为app提供运行环境并负责启动,创建HostBuilder,指定Startup作为启动类</p>
<h4 id="Startup-cs"><a href="#Startup-cs" class="headerlink" title="Startup.cs"></a>Startup.cs</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">public class Startup</span><br><span class="line">&#123;</span><br><span class="line">  public void ConfigureServices(IServiceCollection services)</span><br><span class="line">  &#123;</span><br><span class="line">    services.AddControllersWithViews();</span><br><span class="line">    services.AddDbContext&lt;DataServiceContext&gt;(options &#x3D;&gt;</span><br><span class="line">      options.UseSqlServer(Configuration.GetConnectionString(&quot;DataServiceContext&quot;)));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  public void Configure(IApplicationBuilder app)</span><br><span class="line">  &#123;</span><br><span class="line">      app.UseHttpsRedirection();</span><br><span class="line">      app.UseStaticFiles();</span><br><span class="line">      app.UseMvc();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>startup.cs中using所需地package，包括需要加载（use）地中间件。</p>
<p>另，这里引入了SQL Server需要安装并引入 Microsoft.EntityFrameworkCore;<br>Microsoft.EntityFrameworkCore.SqlServer;</p>
<h4 id="launchSettings-json"><a href="#launchSettings-json" class="headerlink" title="launchSettings.json"></a>launchSettings.json</h4><p>依赖注入Iconfigure，读取配置文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">public class OidcConfigurationController : ControllerBase</span><br><span class="line">&#123;</span><br><span class="line">    private IConfiguration _configuration;</span><br><span class="line">    public OidcConfigurationController(IConfiguration Configuration)</span><br><span class="line">    &#123;</span><br><span class="line">        _configuration &#x3D; Configuration;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    [HttpGet]</span><br><span class="line">    [Route(&quot;snmapi&#x2F;[controller]&#x2F;auth&quot;)]</span><br><span class="line">    public CSResult GetOidcConfigure()</span><br><span class="line">    &#123;</span><br><span class="line">        var authSettings &#x3D; new JObject&#123;</span><br><span class="line">            &#123; &quot;client_id&quot;, _configuration[&quot;Auth:client_id&quot;] &#125;,</span><br><span class="line">            &#123; &quot;redirect_uri&quot;, _configuration[&quot;Auth:redirect_uri&quot;] &#125;,</span><br><span class="line">            &#123; &quot;post_logout_redirect_uri&quot;, _configuration[&quot;Auth:post_logout_redirect_uri&quot;] &#125;,</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>只能逐个value地取值，其他读取方法见<a target="_blank" rel="noopener" href="https://juejin.im/post/6844904070847660045">ASP.Net Core读取配置文件的三种方法</a></p>
<p>Properties/launchSettings.json<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;iisSettings&quot;: &#123;</span><br><span class="line">    &quot;windowsAuthentication&quot;: false,</span><br><span class="line">    &quot;anonymousAuthentication&quot;: true,</span><br><span class="line">    &quot;iisExpress&quot;: &#123;</span><br><span class="line">      &quot;applicationUrl&quot;: &quot;http:&#x2F;&#x2F;localhost:8080&quot;,</span><br><span class="line">      &quot;sslPort&quot;: 0</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;profiles&quot;: &#123;</span><br><span class="line">    &quot;IIS Express&quot;: &#123;</span><br><span class="line">      &quot;commandName&quot;: &quot;IISExpress&quot;,</span><br><span class="line">      &quot;launchBrowser&quot;: true,</span><br><span class="line">      &quot;environmentVariables&quot;: &#123;</span><br><span class="line">        &quot;ASPNETCORE_ENVIRONMENT&quot;: &quot;Development&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;RestrictedProductMaintenance&quot;: &#123;</span><br><span class="line">      &quot;commandName&quot;: &quot;Project&quot;,</span><br><span class="line">      &quot;launchBrowser&quot;: true,</span><br><span class="line">      &quot;environmentVariables&quot;: &#123;</span><br><span class="line">        &quot;ASPNETCORE_ENVIRONMENT&quot;: &quot;Development&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;applicationUrl&quot;: &quot;https:&#x2F;&#x2F;localhost:5001;http:&#x2F;&#x2F;localhost:5000&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>这个配置似乎都是关于运行asp的IIS的。</p>
<h4 id="创建Model"><a href="#创建Model" class="headerlink" title="创建Model"></a>创建Model</h4><blockquote>
<p>issue: Unable to cast object of type ‘System.Guid’ to type ‘System.String’.<br><br>SQL Server 的 uniqueidentifier类型列，在 .net core 中直接映射为Guid类型，不存在与string的隐式转换，因此对应Model里的字段应该是Guid，在必要的场合使用toString<br><br>插入Guid<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Guid id &#x3D; Guid.NewGuid();</span><br></pre></td></tr></table></figure><br>Model定义中的数据库特性</p>
</blockquote>
<p>从数据库生成模型<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Scaffold-DbContext  &quot;Data Source&#x3D;HostName; Initial Catalog&#x3D;DBName; Persist Security Info&#x3D;True; User ID&#x3D;UserName; Password&#x3D;******;&quot; Microsoft.EntityFrameworkCore.SqlServer -OutputDir Models</span><br></pre></td></tr></table></figure></p>
<h4 id="DBContext"><a href="#DBContext" class="headerlink" title="DBContext"></a>DBContext</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">public class DataServiceContext: DbContext</span><br><span class="line">&#123;</span><br><span class="line">    public DataServiceContext(DbContextOptions&lt;DataServiceContext&gt; options) : base(options)</span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public DbSet&lt;RestrictedProductDTO&gt; RestrictedProduct &#123; get; set; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在Startup.cs中添加<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"> public void ConfigureServices(IServiceCollection services)</span><br><span class="line">&#123;</span><br><span class="line">    services.AddControllersWithViews();</span><br><span class="line">    services.AddDbContext&lt;DataContext&gt;(options &#x3D;&gt;</span><br><span class="line">        options.UseSqlServer(Configuration.GetConnectionString(&quot;DataContext&quot;)));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>ConnectionString是从appsettings.json中读取的<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&quot;connectionStrings&quot;: &#123;</span><br><span class="line">    &quot;DataContext&quot;: &quot;Server&#x3D;sqlserver01;Database&#x3D;db01;Trusted_Connection&#x3D;False;user id&#x3D;user01;password&#x3D;xxxx;&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  ...</span><br></pre></td></tr></table></figure><br>数据上下文访问SQL Server，会提示安装Microsoft.EntityFrameworkCore<br><br>这个数据库上下文将被注入controlloer或model中用以获取数据</p>
<h4 id="controller"><a href="#controller" class="headerlink" title="controller"></a>controller</h4><p>使用Add—Add New Scaffold Item（基架项）选择  MVC controlloer with views, using Entity Framework<br><br>之后在对话框中配置业务需要的Model、Data context等，此举一并生成controller views dbcontext代码，views包含index，create，detail，edit，delete，视图上的请求会自动在controller中实现接口<br></p>
<p>Error There was an error running the selected code generator:”No parameterless constructor defined for type ‘XXController’”<br><br>曾现此错误，是因为待注入的Data context未配置正确（在startup中添加configureService，其中的connectionstring配置在appsettings.json中）</p>
<p>创建完成的基架controller<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br></pre></td><td class="code"><pre><span class="line">public class ProductsController : Controller</span><br><span class="line">&#123;</span><br><span class="line">    private readonly DataContext _context;</span><br><span class="line"></span><br><span class="line">    public ProductsController(DataContext context)</span><br><span class="line">    &#123;</span><br><span class="line">        _context &#x3D; context;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; GET: Products</span><br><span class="line">    public async Task&lt;IActionResult&gt; Index()</span><br><span class="line">    &#123;</span><br><span class="line">        return View(await _context.ProductData.ToListAsync());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; GET: Products&#x2F;Details&#x2F;5</span><br><span class="line">    public async Task&lt;IActionResult&gt; Details(string id)</span><br><span class="line">    &#123;</span><br><span class="line">        if (id &#x3D;&#x3D; null)</span><br><span class="line">        &#123;</span><br><span class="line">            return NotFound();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        var product &#x3D; await _context.ProductData</span><br><span class="line">            .FirstOrDefaultAsync(m &#x3D;&gt; m.Id &#x3D;&#x3D; id);</span><br><span class="line">        if (product &#x3D;&#x3D; null)</span><br><span class="line">        &#123;</span><br><span class="line">            return NotFound();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        return View(product);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; GET: Products&#x2F;Create</span><br><span class="line">    public IActionResult Create()</span><br><span class="line">    &#123;</span><br><span class="line">        return View();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; POST: Products&#x2F;Create</span><br><span class="line">    &#x2F;&#x2F; To protect from overposting attacks, enable the specific properties you want to bind to, for </span><br><span class="line">    &#x2F;&#x2F; more details, see http:&#x2F;&#x2F;go.microsoft.com&#x2F;fwlink&#x2F;?LinkId&#x3D;317598.</span><br><span class="line">    [HttpPost]</span><br><span class="line">    [ValidateAntiForgeryToken]</span><br><span class="line">    public async Task&lt;IActionResult&gt; Create([Bind(&quot;Id,SN,Brand,CreateTime,ProductName,Restriction&quot;)] Product product)</span><br><span class="line">    &#123;</span><br><span class="line">        if (ModelState.IsValid)</span><br><span class="line">        &#123;</span><br><span class="line">            _context.Add(product);</span><br><span class="line">            await _context.SaveChangesAsync();</span><br><span class="line">            return RedirectToAction(nameof(Index));</span><br><span class="line">        &#125;</span><br><span class="line">        return View(product);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; GET: Products&#x2F;Edit&#x2F;5</span><br><span class="line">    public async Task&lt;IActionResult&gt; Edit(string id)</span><br><span class="line">    &#123;</span><br><span class="line">        if (id &#x3D;&#x3D; null)</span><br><span class="line">        &#123;</span><br><span class="line">            return NotFound();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        var product &#x3D; await _context.ProductData.FindAsync(id);</span><br><span class="line">        if (product &#x3D;&#x3D; null)</span><br><span class="line">        &#123;</span><br><span class="line">            return NotFound();</span><br><span class="line">        &#125;</span><br><span class="line">        return View(product);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; POST: Products&#x2F;Edit&#x2F;5</span><br><span class="line">    &#x2F;&#x2F; To protect from overposting attacks, enable the specific properties you want to bind to, for </span><br><span class="line">    &#x2F;&#x2F; more details, see http:&#x2F;&#x2F;go.microsoft.com&#x2F;fwlink&#x2F;?LinkId&#x3D;317598.</span><br><span class="line">    [HttpPost]</span><br><span class="line">    [ValidateAntiForgeryToken]</span><br><span class="line">    public async Task&lt;IActionResult&gt; Edit(string id, [Bind(&quot;Id,SN,Brand,CreateTime,ProductName,Restriction&quot;)] Product product)</span><br><span class="line">    &#123;</span><br><span class="line">        if (id !&#x3D; product.Id)</span><br><span class="line">        &#123;</span><br><span class="line">            return NotFound();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        if (ModelState.IsValid)</span><br><span class="line">        &#123;</span><br><span class="line">            try</span><br><span class="line">            &#123;</span><br><span class="line">                _context.Update(product);</span><br><span class="line">                await _context.SaveChangesAsync();</span><br><span class="line">            &#125;</span><br><span class="line">            catch (DbUpdateConcurrencyException)</span><br><span class="line">            &#123;</span><br><span class="line">                if (!ProductExists(product.Id))</span><br><span class="line">                &#123;</span><br><span class="line">                    return NotFound();</span><br><span class="line">                &#125;</span><br><span class="line">                else</span><br><span class="line">                &#123;</span><br><span class="line">                    throw;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            return RedirectToAction(nameof(Index));</span><br><span class="line">        &#125;</span><br><span class="line">        return View(product);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; GET: Products&#x2F;Delete&#x2F;5</span><br><span class="line">    public async Task&lt;IActionResult&gt; Delete(string id)</span><br><span class="line">    &#123;</span><br><span class="line">        if (id &#x3D;&#x3D; null)</span><br><span class="line">        &#123;</span><br><span class="line">            return NotFound();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        var product &#x3D; await _context.ProductData</span><br><span class="line">            .FirstOrDefaultAsync(m &#x3D;&gt; m.Id &#x3D;&#x3D; id);</span><br><span class="line">        if (product &#x3D;&#x3D; null)</span><br><span class="line">        &#123;</span><br><span class="line">            return NotFound();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        return View(product);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; POST: Products&#x2F;Delete&#x2F;5</span><br><span class="line">    [HttpPost, ActionName(&quot;Delete&quot;)]</span><br><span class="line">    [ValidateAntiForgeryToken]</span><br><span class="line">    public async Task&lt;IActionResult&gt; DeleteConfirmed(string id)</span><br><span class="line">    &#123;</span><br><span class="line">        var product &#x3D; await _context.ProductData.FindAsync(id);</span><br><span class="line">        _context.ProductData.Remove(product);</span><br><span class="line">        await _context.SaveChangesAsync();</span><br><span class="line">        return RedirectToAction(nameof(Index));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private bool ProductExists(string id)</span><br><span class="line">    &#123;</span><br><span class="line">        return _context.ProductData.Any(e &#x3D;&gt; e.Id &#x3D;&#x3D; id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>return View() 返回视图，路由是根据Controller名称和方法名称组成的，如这里的Product/Index，Product/Create</p>
<blockquote>
<p>Controller vs ControllerBase</p>
</blockquote>
<p>如果你创建一个 .net core api项目，你会发现api的controller继承ControllerBase，而asp继承Controller<br><br>Controller是ControllerBase的衍生类，支持asp的Views。</p>
<h4 id="Views"><a href="#Views" class="headerlink" title="Views"></a>Views</h4><p>创建Product/Index.cshtml, 这是一个列表页。顶头：<br>@model IEnumerable\<ProductMaintenance.Models.Product\><br></p>
<blockquote>
<p>@model 指令使你能够使用强类型的 Model 对象访问控制器传递给视图的列表。 例如，在 Index.cshtml 视图中，代码使用 foreach 语句通过强类型 Model 对象对列表项进行循环遍历 ：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;table class&#x3D;&quot;table&quot;&gt;</span><br><span class="line">    &lt;thead&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;th&gt;SN&lt;&#x2F;th&gt;</span><br><span class="line">            &lt;th&gt;Brand&lt;&#x2F;th&gt;</span><br><span class="line">            &lt;th&gt;Actions&lt;&#x2F;th&gt;</span><br><span class="line">        &lt;&#x2F;tr&gt;</span><br><span class="line">    &lt;&#x2F;thead&gt;</span><br><span class="line">    &lt;tbody&gt;</span><br><span class="line">        @foreach (var item in Model) &#123;</span><br><span class="line">            &lt;tr&gt;Id</span><br><span class="line">                &lt;td&gt;@Html.DisplayFor(modelItem &#x3D;&gt; item.SN)&lt;&#x2F;td&gt;</span><br><span class="line">                &lt;td&gt;@Html.DisplayFor(modelItem &#x3D;&gt; item.Brand)&lt;&#x2F;td&gt;</span><br><span class="line">                &lt;td&gt;</span><br><span class="line">                    &lt;a asp-action&#x3D;&quot;Edit&quot; asp-route-id&#x3D;&quot;@item.Id&quot;&gt;Edit&lt;&#x2F;a&gt; |</span><br><span class="line">                    &lt;a asp-action&#x3D;&quot;Details&quot; asp-route-id&#x3D;&quot;@item.Id&quot;&gt;Details&lt;&#x2F;a&gt; |</span><br><span class="line">                    &lt;a asp-action&#x3D;&quot;Delete&quot; asp-route-id&#x3D;&quot;@item.Id&quot;&gt;Delete&lt;&#x2F;a&gt;</span><br><span class="line">                &lt;&#x2F;td&gt;</span><br><span class="line">            &lt;&#x2F;tr&gt;</span><br><span class="line">        &#125;</span><br><span class="line">    &lt;&#x2F;tbody&gt;</span><br><span class="line">&lt;&#x2F;table&gt;</span><br></pre></td></tr></table></figure><br>实际上，dotnet提供了视图基架Add—Add New Scaffold Item（基架项）选择  MVC  View之后在对话框中配置业务需要的Model、Data context等，选择模板（list, details, create, edit, delete）<br><br>判断是否为null<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@foreach (var item in Model.childrenMap??new List&lt;Child&gt;())</span><br><span class="line">&#123;</span><br><span class="line">    &lt;tr&gt;</span><br><span class="line">        &lt;td&gt;</span><br><span class="line">            @Html.DisplayFor(modelItem &#x3D;&gt; item.Child.Name)</span><br><span class="line">        &lt;&#x2F;td&gt;</span><br><span class="line">    &lt;&#x2F;tr&gt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="模型驱动数据库设计"><a href="#模型驱动数据库设计" class="headerlink" title="模型驱动数据库设计"></a>模型驱动数据库设计</h4><p>因需求变动，模型结构变化，与数据库产生冲突<br><br>Code First迁移数据模型<br><br>创建数据模型Model,在Nuget Package Manager —&gt; Package Manager Console中执行<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Add-Migration updateModelStructure</span><br><span class="line">&#x2F;&#x2F; updateModelStructure 是一个数据库操作的标题，是任意命名的，仅用于记录更新记录和历史</span><br><span class="line">Update-Database</span><br></pre></td></tr></table></figure><br>Add-Migration之后项目中生成了Migrations类，这些类阐释了如何修改数据库见 <a href="/qqsnote/2020/06/15/entityframework/" title="《Entity Framework》篇">《Entity Framework》篇</a><br><br>issue: The entity type ‘XXModel’ requires a primary key to be defined.<br><br>Model类型需标注主键<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">private Guid _id;</span><br><span class="line">[Key]</span><br><span class="line">public Guid ID</span><br><span class="line">&#123;</span><br><span class="line">    get &#123; return _id; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>issue “No context type was found in the assembly ‘MyServices.Models’.”<br>在多项目解决方案中，执行Migration的是Models项目，读取Startup中的context配置， 检查Startup.cs的addDbContext配置<br>另有命令<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Enable-Migrations -ProjectName MyServices.Models -StartUpProjectName MyServices.API -ContextTypeName MyServices.Models.Contexts.DataContext -Verbose </span><br></pre></td></tr></table></figure><br>issue “The type ‘xxContext’ does not inherit from DbContext. The DbMigrationsConfiguration.ContextType property must be set to a type that inherits from DbContext.”<br>解决方法是在startup项目安装 Microsoft.EntityFrameworkCore.Tools</p>
</blockquote>
<h4 id="业务API"><a href="#业务API" class="headerlink" title="业务API"></a>业务API</h4><h4 id="前端组件-Blazor"><a href="#前端组件-Blazor" class="headerlink" title="前端组件 Blazor"></a>前端组件 <a target="_blank" rel="noopener" href="https://dotnet.microsoft.com/apps/aspnet/web-apps/blazor">Blazor</a></h4><h4 id="发布到IIS"><a href="#发布到IIS" class="headerlink" title="发布到IIS"></a>发布到IIS</h4><p><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/aspnet/core/test/troubleshoot-azure-iis?view=aspnetcore-5.0">TroubleShooting</a></p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/breakus/p/10475246.html"> IIS Issue: HTTP错误500.19 </a></p>
</blockquote>
<p>微软.net core 下载页面有如下加粗提示：</p>
<blockquote>
<p>On Windows, we recommended installing the Hosting Bundle, which includes the .NET Core Runtime and IIS support.</p>
</blockquote>
<p>下载后得到dotnet-hosting-3.0.x.exe<br>另：IIS的远程访问允许<br> <a target="_blank" rel="noopener" href="https://my.oschina.net/zhangqiliang/blog/1932042">新建防火墙规则</a></p>
<p>另: IIS 路由站点<br>新建IIS 的网站指向一个物理路径就可以了，右击网站添加应用程序，指向发布的文件目录，并添加别名，事实上这个别名会作为虚拟路径(子路由)，实现192.168.1.100:80/App1这样的部署。</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/6538926/chrome-returns-bad-request-request-too-long-when-navigating-to-local-iis-exp/38402830">IIS Issue: Chrome 400 Bad Request</a><br><br>某次更新服务后，在IIS上Browser website测试正常，在远程chrome上访问只能get post全部400，新打开一个ie发现是好的(实际上新打开一个chrome隐私窗口也会是好的，这个问题初步被认为与浏览器写了太多cookie有关)</p>
</blockquote>
<h4 id="配置多个环境"><a href="#配置多个环境" class="headerlink" title="配置多个环境"></a>配置多个环境</h4><p><a target="_blank" rel="noopener" href="https://docs.microsoft.com/zh-cn/aspnet/core/fundamentals/environments?view=aspnetcore-3.1">https://docs.microsoft.com/zh-cn/aspnet/core/fundamentals/environments?view=aspnetcore-3.1</a></p>
<h4 id="solution和projects"><a href="#solution和projects" class="headerlink" title="solution和projects"></a>solution和projects</h4><p><a target="_blank" rel="noopener" href="https://medium.com/swlh/creating-a-multi-project-net-core-database-solution-a69decdf8d7e">多项目解决方案(class library projects)</a></p>
<p><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/visualstudio/ide/how-to-set-multiple-startup-projects?view=vs-2019#to-set-multiple-startup-projects">关于多个项目启动</a></p>
<h4 id="关于-HttpGet-HttpPost-标注以及方法HttpMethod识别"><a href="#关于-HttpGet-HttpPost-标注以及方法HttpMethod识别" class="headerlink" title="关于[HttpGet][HttpPost]标注以及方法HttpMethod识别"></a>关于[HttpGet][HttpPost]标注以及方法HttpMethod识别</h4><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/landeanfen/p/5337072.html">CSDN Blog WebApi进阶</a></p>
<blockquote>
<p>博主的理解是：方法名以Get开头，WebApi会自动默认这个请求就是get请求，而如果你以其他名称开头而又不标注方法的请求方式，那么这个时候服务器虽然找到了这个方法，但是由于请求方式不确定，所以直接返回给你405——方法不被允许的错误。<br>结论：所有的WebApi方法最好是加上请求的方式（[HttpGet]/[HttpPost]/[HttpPut]/[HttpDelete]），不要偷懒，这样既能防止类似的错误，也有利于方法的维护，别人一看就知道这个方法是什么请求</p>
</blockquote>
<h4 id="TargetFramework"><a href="#TargetFramework" class="headerlink" title="TargetFramework"></a>TargetFramework</h4><p>项目属性中的item，如\<TargetFramework>net6-windows10.0.22621.0\</TargetFramework> Visual Studio解析为</p>
<ul>
<li>Target framework: .Net 6.0</li>
<li>Target OS: Windows</li>
<li>Target OS version: 10.0.22621.0</li>
</ul>
<p>一般只需要.Net6即可，在 OS 特定的 TargetFramework 的末尾指定可选的 OS 版本，例如，net6.0-ios15.0。 版本指示应用或库可用的 API。 它不控制应用或库在运行时支持的 OS 版本。 它用于选择项目编译的引用程序集，并用于从 NuGet 包中选择资产。 将此版本视为“平台版本”或“OS API 版本”，可以与运行时 OS 版本进行区分。</p>
<p>当特定于 OS 的 TargetFramework 不显式指定平台版本时，它具有可从基础 TargetFramework 和平台名称推断的隐含值。 例如，.NET 6 中 iOS 的默认平台值为 15.0，这意味着 net6.0-ios 是规范 net6.0-ios15.0 TargetFramework 的简写形式。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://qqstone.github.io/qqsnote/2020/05/07/webpack/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/qqsnote/images/avatar.gif">
      <meta itemprop="name" content="QQs">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="QQs'Note">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/qqsnote/2020/05/07/webpack/" class="post-title-link" itemprop="url">webpack</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-05-07 18:53:49" itemprop="dateCreated datePublished" datetime="2020-05-07T18:53:49+08:00">2020-05-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-08-09 11:45:42" itemprop="dateModified" datetime="2025-08-09T11:45:42+08:00">2025-08-09</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/qqsnote/categories/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index"><span itemprop="name">前端技术</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h4 id="关于Webpack的学了又忘"><a href="#关于Webpack的学了又忘" class="headerlink" title="关于Webpack的学了又忘"></a>关于Webpack的学了又忘</h4><p>再看这一部分，是因为配置 <a href="/qqsnote/2020/07/16/React-Ecosystem/" title="craco">craco</a>过程中碰壁，Webpack是常用的工程化工具，前端开发需要Webpack地方，大多是需要配置Webpack configure向工程中嵌入一些插件</p>
<blockquote>
<p>「面试当中有时候会问到 Webpack 相关的配置」是我首先要强烈批判的点，也是 Webpack 学习雷区，「熟背 Webpack」并不是健康的学习导向。———— <a target="_blank" rel="noopener" href="https://www.zhihu.com/tardis/zm/ans/2438957473?source_id=1003">《前端有必要学Webpack吗》</a></p>
</blockquote>
<ul>
<li>Code Splitting 代码分割</li>
<li>Hashing 指资源的版本信息映射</li>
<li>Importing Modules 引入模块</li>
<li>Non-JavaScript Resources 支持非JavaScript 类型资源</li>
<li>Output Module Formats 输出模块格式</li>
<li>Transformations 转译</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://juejin.cn/post/6844903668399996935">我是如何用 Webpack 虐待代码尺寸的</a></p>
<h4 id="安装配置webpack"><a href="#安装配置webpack" class="headerlink" title="安装配置webpack"></a>安装配置webpack</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i webpack webpack-cli</span><br></pre></td></tr></table></figure>
<p>webpack.config.js<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">const path &#x3D; require(&#39;path&#39;)</span><br><span class="line"></span><br><span class="line">module.exports &#x3D; &#123;</span><br><span class="line">    mode:&#39;development&#39;,</span><br><span class="line">    entry:&#39;.&#x2F;src&#x2F;index.js&#39;,</span><br><span class="line">    output:&#123;</span><br><span class="line">        filename:&#39;bundle.js&#39;,</span><br><span class="line">        path:path.resolve(__dirname, &#39;dist&#39;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx webpack --config webpack.config.js</span><br></pre></td></tr></table></figure></p>
<h4 id="模块"><a href="#模块" class="headerlink" title="模块"></a>模块</h4><blockquote>
<p>模块化编程中，开发者将程序分解为功能离散的chunk，并称之为模块</p>
</blockquote>
<p>Node.js是从一开始就支持模块化编程的环境，其将一段js逻辑export为一个module，随着web发展，模块化逐渐得到支持，webpack工具设计为可将模块化应用到任何文件中<br>除了js的module外，还有css/less/sass的module，以及wasm的module等</p>
<p>不同‘文件和语言的’模块使用对应的loader引入app<br>demo project:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">webpack-demo</span><br><span class="line">  |- package.json</span><br><span class="line">  |- webpack.config.js</span><br><span class="line">  |- &#x2F;dist</span><br><span class="line">    |- bundle.js</span><br><span class="line">    |- index.html</span><br><span class="line">  |- &#x2F;src</span><br><span class="line">    |- data.xml</span><br><span class="line">    |- my-font.woff</span><br><span class="line">    |- my-font.woff2</span><br><span class="line">    |- icon.png</span><br><span class="line">    |- style.css</span><br><span class="line">    |- index.js</span><br><span class="line">  |- &#x2F;node_modules</span><br></pre></td></tr></table></figure><br>webpack.config.js<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">const path &#x3D; require(&#39;path&#39;);</span><br><span class="line"></span><br><span class="line">module.exports &#x3D; &#123;</span><br><span class="line">  entry: &#39;.&#x2F;src&#x2F;index.js&#39;,</span><br><span class="line">  output: &#123;</span><br><span class="line">    filename: &#39;bundle.js&#39;,</span><br><span class="line">    path: path.resolve(__dirname, &#39;dist&#39;)</span><br><span class="line">  &#125;,</span><br><span class="line">  module: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: &#x2F;\.css$&#x2F;,</span><br><span class="line">        use: [</span><br><span class="line">          &#39;style-loader&#39;,</span><br><span class="line">          &#39;css-loader&#39;</span><br><span class="line">        ]</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        test: &#x2F;\.(png|svg|jpg|gif)$&#x2F;,</span><br><span class="line">        use: [</span><br><span class="line">          &#39;file-loader&#39;</span><br><span class="line">        ]</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        test: &#x2F;\.(woff|woff2|eot|ttf|otf)$&#x2F;,</span><br><span class="line">        use: [</span><br><span class="line">          &#39;file-loader&#39;</span><br><span class="line">        ]</span><br><span class="line">      &#125;,</span><br><span class="line">     &#123;</span><br><span class="line">       test: &#x2F;\.(csv|tsv)$&#x2F;,</span><br><span class="line">       use: [</span><br><span class="line">         &#39;csv-loader&#39;</span><br><span class="line">       ]</span><br><span class="line">     &#125;,</span><br><span class="line">     &#123;</span><br><span class="line">       test: &#x2F;\.xml$&#x2F;,</span><br><span class="line">       use: [</span><br><span class="line">         &#39;xml-loader&#39;</span><br><span class="line">       ]</span><br><span class="line">     &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><br>index.js<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">import _ from &#39;lodash&#39;;</span><br><span class="line">import &#39;.&#x2F;style.css&#39;;</span><br><span class="line">import Icon from &#39;.&#x2F;icon.png&#39;;</span><br><span class="line">import Data from &#39;.&#x2F;data.xml&#39;;</span><br><span class="line"></span><br><span class="line">function component() &#123;</span><br><span class="line">  var element &#x3D; document.createElement(&#39;div&#39;);</span><br><span class="line"></span><br><span class="line">  &#x2F;&#x2F; Lodash, now imported by this script</span><br><span class="line">  element.innerHTML &#x3D; _.join([&#39;Hello&#39;, &#39;webpack&#39;], &#39; &#39;);</span><br><span class="line">  element.classList.add(&#39;hello&#39;);</span><br><span class="line"></span><br><span class="line">  &#x2F;&#x2F; Add the image to our existing div.</span><br><span class="line">  var myIcon &#x3D; new Image();</span><br><span class="line">  myIcon.src &#x3D; Icon;</span><br><span class="line"></span><br><span class="line">  element.appendChild(myIcon);</span><br><span class="line"></span><br><span class="line">  console.log(Data);</span><br><span class="line"></span><br><span class="line">  return element;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">document.body.appendChild(component());</span><br></pre></td></tr></table></figure></p>
<h4 id="管理输出"><a href="#管理输出" class="headerlink" title="管理输出"></a>管理输出</h4><p>webpack 将打包好的各模块的bundle.js文件引用到app入口index.js中，若对入口文件修改可如下配置，使bundle.js引用到新的入口<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">var HtmlWebpackPlugin &#x3D; require(&#39;html-webpack-plugin&#39;)</span><br><span class="line">const path &#x3D; require(&#39;path&#39;);</span><br><span class="line"></span><br><span class="line">  module.exports &#x3D; &#123;</span><br><span class="line">    entry: &#123;</span><br><span class="line">      app: &#39;.&#x2F;src&#x2F;index.js&#39;,</span><br><span class="line">      print: &#39;.&#x2F;src&#x2F;print.js&#39;</span><br><span class="line">    &#125;,</span><br><span class="line">    output: &#123;</span><br><span class="line">      filename: &#39;[name].bundle.js&#39;,</span><br><span class="line">      path: path.resolve(__dirname, &#39;dist&#39;),</span><br><span class="line">      plugins: [new HtmlWebpackPlugin()]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br></pre></td></tr></table></figure></p>
<h4 id="source-map-devtool-plugin"><a href="#source-map-devtool-plugin" class="headerlink" title="source map devtool plugin"></a>source map devtool plugin</h4><p>源码映射以便随浏览器运行进行调试，参考 <a target="_blank" rel="noopener" href="https://webpack.js.org/plugins/source-map-dev-tool-plugin/#root">SourceMapDevToolPlugin</a></p>
<h4 id="webpack-bundle-analyzer"><a href="#webpack-bundle-analyzer" class="headerlink" title="webpack-bundle-analyzer"></a>webpack-bundle-analyzer</h4><p>模块打包结构分析插件,参考<a target="_blank" rel="noopener" href="https://github.com/webpack-contrib/webpack-bundle-analyzer">webpack官方—webpack-bundle-analyzer
</a></p>
<p>安装<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm intall --save-dev webpack-bundle-analyzer</span><br></pre></td></tr></table></figure><br>在Angular项目中使用<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ng build --prod --stats-json</span><br><span class="line">npx webpack-bundle-analyzer dist&#x2F;stats.json</span><br></pre></td></tr></table></figure><br>在自定义项目中, 添加plugin<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; webpack.config.js 文件</span><br><span class="line"></span><br><span class="line">const BundleAnalyzerPlugin &#x3D; require(&#39;webpack-bundle-analyzer&#39;).BundleAnalyzerPlugin</span><br><span class="line">module.exports&#x3D;&#123;</span><br><span class="line">  plugins: [</span><br><span class="line">    new BundleAnalyzerPlugin()  &#x2F;&#x2F; 使用默认配置</span><br><span class="line">    &#x2F;&#x2F; 默认配置的具体配置项</span><br><span class="line">    &#x2F;&#x2F; new BundleAnalyzerPlugin(&#123;</span><br><span class="line">    &#x2F;&#x2F;   analyzerMode: &#39;server&#39;,</span><br><span class="line">    &#x2F;&#x2F;   analyzerHost: &#39;127.0.0.1&#39;,</span><br><span class="line">    &#x2F;&#x2F;   analyzerPort: &#39;8888&#39;,</span><br><span class="line">    &#x2F;&#x2F;   reportFilename: &#39;report.html&#39;,</span><br><span class="line">    &#x2F;&#x2F;   defaultSizes: &#39;parsed&#39;,</span><br><span class="line">    &#x2F;&#x2F;   openAnalyzer: true,</span><br><span class="line">    &#x2F;&#x2F;   generateStatsFile: false,</span><br><span class="line">    &#x2F;&#x2F;   statsFilename: &#39;stats.json&#39;,</span><br><span class="line">    &#x2F;&#x2F;   statsOptions: null,</span><br><span class="line">    &#x2F;&#x2F;   excludeAssets: null,</span><br><span class="line">    &#x2F;&#x2F;   logLevel: info</span><br><span class="line">    &#x2F;&#x2F; &#125;)</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><img src="https://tva1.sinaimg.cn/large/a60edd42gy1gij0uq9lyqj21fx0py7ft.jpg" alt="link-app-bundle-analyze"><br>scan-link, react+vtk.js+materialUI的项目</p>
<h4 id="loader"><a href="#loader" class="headerlink" title="loader"></a>loader</h4><p>loader是webpack可调用的一些对文件预处理的模块<br><a target="_blank" rel="noopener" href="https://webpack.docschina.org/concepts/loaders/#inline">内联调用loader</a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">import MyIcon from &#39;-!svg-react-loader!..&#x2F;..&#x2F;assets&#x2F;image&#x2F;icon.svg&#39;</span><br></pre></td></tr></table></figure></p>
<h4 id="typescript"><a href="#typescript" class="headerlink" title="typescript"></a>typescript</h4><p>webpack 集成 typescript：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save-dev typescript ts-loader</span><br></pre></td></tr></table></figure><br>添加tsconfig.json<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;compilerOptions&quot;: &#123;</span><br><span class="line">    &quot;outDir&quot;: &quot;.&#x2F;dist&#x2F;&quot;,</span><br><span class="line">    &quot;noImplicitAny&quot;: true,</span><br><span class="line">    &quot;module&quot;: &quot;es6&quot;,</span><br><span class="line">    &quot;target&quot;: &quot;es5&quot;,</span><br><span class="line">    &quot;jsx&quot;: &quot;react&quot;,</span><br><span class="line">    &quot;allowJs&quot;: true</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="环境变量"><a href="#环境变量" class="headerlink" title="环境变量"></a>环境变量</h4><blockquote>
<p>There is also a built-in environment variable called NODE_ENV. You can read it from process.env.NODE_ENV. When you run npm start, it is always equal to ‘development’, when you run npm test it is always equal to ‘test’, and when you run npm run build to make a production bundle, it is always equal to ‘production’. You cannot override NODE_ENV manually. This prevents developers from accidentally deploying a slow development build to production. ————<a target="_blank" rel="noopener" href="https://create-react-app.dev/docs/adding-custom-environment-variables">《create-react-app自定义环境变量》</a></p>
</blockquote>
<p>禁止生成SourceMap, 注意不要在&amp;&amp;之前添加多余空格<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set GENERATE_SOURCEMAP&#x3D;false&amp;&amp; yarn build</span><br></pre></td></tr></table></figure></p>
<h4 id="代码访问静态资源"><a href="#代码访问静态资源" class="headerlink" title="代码访问静态资源"></a>代码访问静态资源</h4><blockquote>
<p>vue中绑定静态资源路径需要如url: require(‘@/assets/images/threelogo.png’) 为什么url用字符串不行</p>
</blockquote>
<p>通过webpack的工程化，静态资源以require模块的形式导入上下文， @ 是 Webpack 中配置的路径别名，通常指向 src 目录。使用 require(‘@/assets/images/threelogo.png’) 可以确保路径正确解析。</p>
<p>public目录的资源一般不需要经过webpack解析</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://qqstone.github.io/qqsnote/2020/05/06/QuickApp/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/qqsnote/images/avatar.gif">
      <meta itemprop="name" content="QQs">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="QQs'Note">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/qqsnote/2020/05/06/QuickApp/" class="post-title-link" itemprop="url">QuickApp</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-05-06 13:38:35" itemprop="dateCreated datePublished" datetime="2020-05-06T13:38:35+08:00">2020-05-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-07-05 10:07:52" itemprop="dateModified" datetime="2025-07-05T10:07:52+08:00">2025-07-05</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://qqstone.github.io/qqsnote/2020/04/27/npm/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/qqsnote/images/avatar.gif">
      <meta itemprop="name" content="QQs">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="QQs'Note">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/qqsnote/2020/04/27/npm/" class="post-title-link" itemprop="url">npm</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-04-27 15:23:24" itemprop="dateCreated datePublished" datetime="2020-04-27T15:23:24+08:00">2020-04-27</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-10-25 11:10:17" itemprop="dateModified" datetime="2025-10-25T11:10:17+08:00">2025-10-25</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/qqsnote/categories/%E5%B7%A5%E5%85%B7/" itemprop="url" rel="index"><span itemprop="name">工具</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h4 id="npm-ls"><a href="#npm-ls" class="headerlink" title="npm ls"></a>npm ls</h4><h4 id="npm-prune-清理无关package"><a href="#npm-prune-清理无关package" class="headerlink" title="npm prune 清理无关package"></a>npm prune 清理无关package</h4><h4 id="npm-i-—prefix"><a href="#npm-i-—prefix" class="headerlink" title="npm i —prefix"></a>npm i —prefix</h4><h4 id="issue-npm-ERR-Error-EPERM-operation-not-permitted-rename"><a href="#issue-npm-ERR-Error-EPERM-operation-not-permitted-rename" class="headerlink" title="issue: npm ERR! Error: EPERM: operation not permitted, rename"></a>issue: npm ERR! Error: EPERM: operation not permitted, rename</h4><p>use ‘npm cache clean’<br><a target="_blank" rel="noopener" href="https://github.com/npm/npm/issues/10826">npm install fails on Windows: “Error: EPERM: operation not permitted, rename” #10826</a></p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/expo/create-react-native-app/issues/191#issuecomment-304073970">疑杀毒软件问题</a></p>
</blockquote>
<h4 id="npx"><a href="#npx" class="headerlink" title="npx"></a>npx</h4><p>npx是npm的命令，创建React App时使用了如下命令<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx create-react-app my-app</span><br></pre></td></tr></table></figure><br>npm 用于包管理（安装、卸载、调用已安装的包blabla），npx在此基础上提高使用包的体验，实际上，调用上述命令时，npm依次查找create-react-app的依赖，无法找到则从网络安装，随后调用创建项目，并在包命令执行结束后删除。</p>
<h4 id="npm-link"><a href="#npm-link" class="headerlink" title="npm link"></a>npm link</h4><h4 id="用软链接共享node-modules"><a href="#用软链接共享node-modules" class="headerlink" title="用软链接共享node_modules"></a>用软链接共享node_modules</h4><p>须知node_modules使用Portable的方式管理依赖，规避了依赖树上的版本冲突，见 <a target="_blank" rel="noopener" href="https://www.zhihu.com/question/55089754/answer/145129917">知乎：每个项目文件夹下都需要有node_modules吗？</a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mklink &#x2F;d D:\project\B\node_modules D:\project\A\node_modules</span><br></pre></td></tr></table></figure></p>
<h4 id="源"><a href="#源" class="headerlink" title="源"></a>源</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm --registry https:&#x2F;&#x2F;registry.npm.taobao.org install </span><br></pre></td></tr></table></figure>
<p>设置<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm config set registry https:&#x2F;&#x2F;registry.npm.taobao.org</span><br></pre></td></tr></table></figure></p>
<h4 id="pnpm"><a href="#pnpm" class="headerlink" title="pnpm"></a>pnpm</h4><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/cangqinglang/p/14448329.html">为什么现在我更推荐 pnpm 而不是 npm/yarn?</a><br><img src="https://img2020.cnblogs.com/blog/1313648/202102/1313648-20210225174230334-853579081.png" alt="mindset"></p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV15oKqzhEMW/?spm_id_from=333.337.search-card.all.click&amp;vd_source=b2d23405df0a481dfc79fc12f92fe247">Bilibili npm yarn pnpm的区别</a></p>
<p>npm 早期版本 递归安装依赖 会产生重复下载 依赖包深度嵌套的问题 现代版本中引入了扁平化管理 遗留问题：串行安装速度慢 每个项目都安装庞大的node_modules</p>
<p>yarn 并行安装 因不适用项目下node_modules 很多代码提示/补全工具可能失明 </p>
<p>pnpm 提供极致的磁盘空间效率 特定的依赖包版本在磁盘上只会保存一份(pnpm store); 硬链接 + 软连接</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://qqstone.github.io/qqsnote/2020/04/26/AngularAboutTest/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/qqsnote/images/avatar.gif">
      <meta itemprop="name" content="QQs">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="QQs'Note">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/qqsnote/2020/04/26/AngularAboutTest/" class="post-title-link" itemprop="url">Angular About Test</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-04-26 13:08:50" itemprop="dateCreated datePublished" datetime="2020-04-26T13:08:50+08:00">2020-04-26</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-07-05 10:07:52" itemprop="dateModified" datetime="2025-07-05T10:07:52+08:00">2025-07-05</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/qqsnote/categories/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index"><span itemprop="name">前端技术</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h4 id="lint"><a href="#lint" class="headerlink" title="lint"></a>lint</h4><p>静态代码检查(static code verify)，运行ng lint，根据项目目录下的tslint.json所配置的规则，检查诸如命名，空行，triple-equals等书写规范，在命令行输出违反规范的位置。<br>加参数—fix可自动修复绝大多数的检查错误</p>
<p>Unfortunately，tslint已于2019宣布停止维护，并迁移至typescript-eslint，见<a target="_blank" rel="noopener" href="https://medium.com/palantir/tslint-in-2019-1a144c2317a9">TSLint in 2019</a><br>关于从TSLint到typescript-eslint，参考<a target="_blank" rel="noopener" href="https://github.com/typescript-eslint/tslint-to-eslint-config">Migrate the repo to ESLint</a>, 实际上只需<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx tslint-to-eslint-config</span><br></pre></td></tr></table></figure><br>对于Angular，关于迁移，Angular团队提出了关于性能以及与现有工具链一致性的要求，见<a target="_blank" rel="noopener" href="https://github.com/angular/angular-cli/issues/13732#issuecomment-575796158">issue#13732</a>, 目前有<a target="_blank" rel="noopener" href="https://github.com/angular-eslint/angular-eslint">angular-eslint plugin</a>支持10.1及以上版本，以实现从tslint到eslint的迁移<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">##Step 1 - Add relevant dependencies</span><br><span class="line">ng add @angular-eslint&#x2F;schematics</span><br><span class="line">##Step 2 - Run the convert-tslint-to-eslint schematic on a project</span><br><span class="line">ng g @angular-eslint&#x2F;schematics:convert-tslint-to-eslint &#123;&#123;YOUR_PROJECT_NAME_GOES_HERE&#125;&#125;</span><br><span class="line">##Step 3 - Remove root TSLint configuration and use only ESLint</span><br></pre></td></tr></table></figure></p>
<h4 id="Karma"><a href="#Karma" class="headerlink" title="Karma"></a>Karma</h4><p>Karma, 业（佛教观念，个人因果的集合）Karma是测试JavaScript代码而生的自动化测试管理工具，可监控文件的变化，自动执行测试。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&quot;karma&quot;: &quot;^5.0.2&quot;,</span><br><span class="line">&quot;karma-chrome-launcher&quot;: &quot;~3.1.0&quot;,</span><br><span class="line">&quot;karma-coverage-istanbul-reporter&quot;: &quot;~2.1.0&quot;,</span><br><span class="line">&quot;karma-jasmine&quot;: &quot;~2.0.1&quot;,</span><br><span class="line">&quot;karma-jasmine-html-reporter&quot;: &quot;^1.4.2&quot;,</span><br></pre></td></tr></table></figure></p>
<h4 id="Jasmine-（Jasminum-茉莉）"><a href="#Jasmine-（Jasminum-茉莉）" class="headerlink" title="Jasmine （Jasminum 茉莉）"></a>Jasmine （Jasminum 茉莉）</h4><p>Angular CLI 会下载并安装试用 Jasmine 测试框架 测试 Angular 应用<br><br>X.spec.ts文件用于Jasmine做单元测试<br>见<a href="/qqsnote/2020/12/11/Jasmine/" title="Jasmine">Jasmine</a></p>
<h4 id="单元测试"><a href="#单元测试" class="headerlink" title="单元测试"></a>单元测试</h4><blockquote>
<p>单元测试（英語：Unit Testing）又称为模块测试，是针对程序模块（软件设计的最小单位）来进行正确性检验的测试工作。 程序单元是应用的最小可测试部件。 在过程化编程中，一个单元就是单个程序、函数、过程等；对于面向对象编程，最小单元就是方法，包括基类（超类）、抽象类、或者派生类（子类）中的方法。</p>
</blockquote>
<p>单元测试是为了测试代码逻辑，每个‘单元’在用例场景下是否能返回期望的结果，仅此而已<br><a target="_blank" rel="noopener" href="https://angular.cn/generated/live-examples/testing/specs.stackblitz.html">栗子</a><br>假设为UserService.ts设计单元测试，须知<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">export class UserService&#123;</span><br><span class="line">  constructor(private commonHTTP:CommonHTTPService)&#123; &#125;</span><br><span class="line"></span><br><span class="line">  getUserByID(id:string):Observable&lt;any&gt;&#123;</span><br><span class="line">    return commonHTTP.get(id)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>UserService.spec.ts<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">describe(&#39;UserService&#39;, ()&#x3D;&gt;&#123;</span><br><span class="line">  it(&#39;getUserByID return stubbed value from a spy&#39;, ()&#x3D;&gt;&#123;</span><br><span class="line">    const commonHTTPSpy &#x3D; jasmine.createSpyObj(&#39;CommonHTTPService&#39;, [&#39;get&#39;]);</span><br><span class="line">    const stubValue &#x3D; &#39;stub value&#39;;</span><br><span class="line">    commonHTTPSpy.get.and.returnValue(stubValue);</span><br><span class="line"></span><br><span class="line">    const userService &#x3D; new UserService(commonHTTPSpy);</span><br><span class="line">    expect(userService.getUserByID(1)).toBe(stubValue,&#39;service returned stub value&#39;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><br>上例待测</p>
<h4 id="e2e"><a href="#e2e" class="headerlink" title="e2e"></a>e2e</h4><p>ng e2e builds and serves app, then runs end-to-end test with Protractor(端对端测试工具，protractor原意是量角器，Angular是角).</p>
<h4 id="配置使用Headless-Chrome"><a href="#配置使用Headless-Chrome" class="headerlink" title="配置使用Headless Chrome"></a>配置使用Headless Chrome</h4><p><a target="_blank" rel="noopener" href="https://angular.cn/guide/testing#configure-cli-for-ci-testing-in-chrome">Angular.cn: 为在 Chrome 中运行 CI 测试而配置 CLI</a><br>karma.conf.js<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">browsers: [&#39;ChromeHeadlessCI&#39;],</span><br><span class="line">customLaunchers: &#123;</span><br><span class="line">  ChromeHeadlessCI: &#123;</span><br><span class="line">    base: &#39;ChromeHeadless&#39;,</span><br><span class="line">    flags: [&#39;--no-sandbox&#39;]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><br>e2e/protractor.conf.js<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">const config &#x3D; require(&#39;.&#x2F;protractor.conf&#39;).config;</span><br><span class="line"></span><br><span class="line">config.capabilities &#x3D; &#123;</span><br><span class="line">  browserName: &#39;chrome&#39;,</span><br><span class="line">  chromeOptions: &#123;</span><br><span class="line">    args: [&#39;--headless&#39;, &#39;--no-sandbox&#39;]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">exports.config &#x3D; config;</span><br></pre></td></tr></table></figure></p>
<h4 id="code-coverage"><a href="#code-coverage" class="headerlink" title="code coverage"></a>code coverage</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ng test --code-coverage</span><br></pre></td></tr></table></figure>
<p>或-cc输出代码覆盖率报告，其他参数见<a target="_blank" rel="noopener" href="https://angular.io/cli/test">Angular Docs</a></p>
<blockquote>
<p>Issues:Uncaught NetworkError: Failed to execute ‘send’ on ‘XMLHttpRequest’: Failed to load ‘ng:///XXXComponent/%C9%B5fac.js’.</p>
</blockquote>
<p>使用—source-map=false避免test fail见<a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/45399079/angular-tests-failing-with-failed-to-execute-send-on-xmlhttprequest">StackOverflow:Angular tests failing with Failed to execute ‘send’ on ‘XMLHttpRequest’</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://qqstone.github.io/qqsnote/2020/04/26/AngularSSR/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/qqsnote/images/avatar.gif">
      <meta itemprop="name" content="QQs">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="QQs'Note">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/qqsnote/2020/04/26/AngularSSR/" class="post-title-link" itemprop="url">Angular 服务端渲染</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-04-26 13:05:15" itemprop="dateCreated datePublished" datetime="2020-04-26T13:05:15+08:00">2020-04-26</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-07-05 10:07:52" itemprop="dateModified" datetime="2025-07-05T10:07:52+08:00">2025-07-05</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/qqsnote/categories/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index"><span itemprop="name">前端技术</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><a target="_blank" rel="noopener" href="https://angular.cn/guide/universal#universal-tutorial">服务端渲染（Server Side Render, SSR）</a></p>
<ul>
<li><p>通过搜索引擎优化(SEO)来帮助网络爬虫。</p>
<p>  根据之前写简单爬虫的经历，以模仿使用者浏览静态页面并匹配目标内容为原理的爬虫，难以识别模块化的angular页面资源，SSR方式可以让每个 URL 返回的都是一个完全渲染好的页面。</p>
</li>
<li><p>迅速显示出第一个支持首次内容绘制(FCP)的页面</p>
<p>  据说如果页面加载超过了三秒钟，那么 <a target="_blank" rel="noopener" href="https://www.doubleclickbygoogle.com/articles/mobile-speed-matters/">53% 的移动网站会被放弃</a><br><br>  着陆页（landing pages），看起来就和完整的应用一样。 这些着陆页是纯 HTML，并且即使 JavaScript 被禁用了也能显示。 这些页面不会处理浏览器事件，不过它们可以用 <a href="guide/router#router-link">routerLink</a> 在这个网站中导航。</p>
</li>
<li><p>提升在手机和低功耗设备上的性能</p>
<p>  在执行JavaScript存在困难的设备上，可以显示出静态页面，而不是直接crush。。。大概是有机会说“抱歉，blabla”</p>
</li>
</ul>
<h4 id="nguniversal-express-engine-模板"><a href="#nguniversal-express-engine-模板" class="headerlink" title="@nguniversal/express-engine 模板"></a>@nguniversal/express-engine 模板</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm add @nguniversal&#x2F;express-engine --clientProject QQsNgApp</span><br></pre></td></tr></table></figure>
<p>于是原angular项目变为anguar应用与express server混合项目<br>新增<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">.&#x2F;server.ts</span><br><span class="line">.&#x2F;tsconfig.server.json</span><br><span class="line">.&#x2F;webpack.server.config.js</span><br><span class="line">.&#x2F;src&#x2F;main.server.ts</span><br><span class="line">.&#x2F;src&#x2F;app&#x2F;app.server.module.ts</span><br></pre></td></tr></table></figure><br>篡改<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">angular.json:</span><br><span class="line">+ products.QQsNgApp.architect.serve&#x3D;&#123;...&#125;</span><br><span class="line"></span><br><span class="line">main.ts:</span><br><span class="line">document.addEventListener(&#39;DOMContentLoaded&#39;, () &#x3D;&gt; &#123;</span><br><span class="line">    bootstrap();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">package.json:</span><br><span class="line">scripts: </span><br><span class="line">+ &quot;compile:server&quot;: &quot;webpack --config webpack.server.config.js --progress --colors&quot;,</span><br><span class="line">+ &quot;serve:ssr&quot;: &quot;node dist&#x2F;server&quot;,</span><br><span class="line">+ &quot;build:ssr&quot;: &quot;npm run build:client-and-server-bundles &amp;&amp; npm run compile:server&quot;,</span><br><span class="line">+ &quot;build:client-and-server-bundles&quot;: &quot;ng build --prod &amp;&amp; ng run csd-ams-front:server:production --bundleDependencies all&quot;</span><br><span class="line">...</span><br></pre></td></tr></table></figure><br>服务端渲染无法调用windows对象，继而document, localstorage等对象会报undefined</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://qqstone.github.io/qqsnote/2020/04/26/TypeScript-JsonMapping/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/qqsnote/images/avatar.gif">
      <meta itemprop="name" content="QQs">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="QQs'Note">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/qqsnote/2020/04/26/TypeScript-JsonMapping/" class="post-title-link" itemprop="url">TypeScript_JsonMapping</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-04-26 13:01:33" itemprop="dateCreated datePublished" datetime="2020-04-26T13:01:33+08:00">2020-04-26</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-07-05 10:07:52" itemprop="dateModified" datetime="2025-07-05T10:07:52+08:00">2025-07-05</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://qqstone.github.io/qqsnote/2020/04/21/electron-issues/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/qqsnote/images/avatar.gif">
      <meta itemprop="name" content="QQs">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="QQs'Note">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/qqsnote/2020/04/21/electron-issues/" class="post-title-link" itemprop="url">electron_issues</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-04-21 10:00:11" itemprop="dateCreated datePublished" datetime="2020-04-21T10:00:11+08:00">2020-04-21</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-07-05 10:07:52" itemprop="dateModified" datetime="2025-07-05T10:07:52+08:00">2025-07-05</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/qqsnote/categories/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index"><span itemprop="name">前端技术</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h4 id="停止和退出"><a href="#停止和退出" class="headerlink" title="停止和退出"></a>停止和退出</h4><blockquote>
<p>app.quit未完全结束进程</p>
</blockquote>
<p>在exe执行中未现问题</p>
<blockquote>
<p>Cannot find module ‘./src/….’<br><a target="_blank" rel="noopener" href="https://github.com/electron-userland/electron-builder/issues/303">Github Issue</a><br>将文件pattern添加到electron-builder的打包规则中</p>
</blockquote>
<p>另外，require import的路径均不区分大小写，configure.ts被活生生编译并打包为Configure.js以及Configure.map.js<br>import编译成require，找不到configure</p>
<blockquote>
<p>无边透明窗体显示时出现闪烁 <a target="_blank" rel="noopener" href="https://github.com/electron/electron/issues/10069">Issue#10069</a></p>
</blockquote>
<p>该问题是由于webview plugin无法设置透明背景造成的，在BrowserWindow show过程中显示了webview的白色背景，目前的workaround可以延迟页面内容的显示<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">function showBrowserWindow() &#123;</span><br><span class="line">  win.setOpacity(0);</span><br><span class="line">  win.show();</span><br><span class="line">  setTimeout(() &#x3D;&gt; &#123;</span><br><span class="line">    win.setOpacity(1);</span><br><span class="line">  &#125;, 50);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>rebuild fail<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gyp ERR! clean error</span><br><span class="line">gyp ERR! stack Error: EPERM: operation not permitted, unlink &#39;D:\projxxx\node_modules\ref\build\Release\binding.node&#39;</span><br></pre></td></tr></table></figure><br>往往是项目文件正在使用中（正在参与其他进程的编译或执行）</p>
</blockquote>
<h4 id="oauth2"><a href="#oauth2" class="headerlink" title="oauth2"></a>oauth2</h4><blockquote>
<p>早先本机应用程序使用嵌入的用户代理(嵌入的web view)进行OAuth授权请求，这种方法有很多缺点，包括主机应用程序<br>能够复制用户凭据和Cookie，以及需要在每个应用程序中从头进行身份验证的用户。<a target="_blank" rel="noopener" href="https://tools.ietf.org/html/rfc8252">IETF RFC 8252</a>。<br>使用浏览器被认为更加安全且容易保留认证状态<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">+~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~+</span><br><span class="line">|          User Device          |</span><br><span class="line">|                               |</span><br><span class="line">| +--------------------------+  | (5) Authorization  +---------------+</span><br><span class="line">| |                          |  |     Code           |               |</span><br><span class="line">| |        Client App        |----------------------&gt;|     Token     |</span><br><span class="line">| |                          |&lt;----------------------|    Endpoint   |</span><br><span class="line">| +--------------------------+  | (6) Access Token,  |               |</span><br><span class="line">|   |             ^             |     Refresh Token  +---------------+</span><br><span class="line">|   |             |             |</span><br><span class="line">|   |             |             |</span><br><span class="line">|   | (1)         | (4)         |</span><br><span class="line">|   | Authorizat- | Authoriza-  |</span><br><span class="line">|   | ion Request | tion Code   |</span><br><span class="line">|   |             |             |</span><br><span class="line">|   |             |             |</span><br><span class="line">|   v             |             |</span><br><span class="line">| +---------------------------+ | (2) Authorization  +---------------+</span><br><span class="line">| |                           | |     Request        |               |</span><br><span class="line">| |          Browser          |---------------------&gt;| Authorization |</span><br><span class="line">| |                           |&lt;---------------------|    Endpoint   |</span><br><span class="line">| +---------------------------+ | (3) Authorization  |               |</span><br><span class="line">|                               |     Code           +---------------+</span><br><span class="line">+~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~+</span><br><span class="line"></span><br></pre></td></tr></table></figure><br>对于electron，渲染界面提供入口signin, 点击会调用默认浏览器打开登录页，authenticate通过后，重定向过程会将授权码或直接将access token返回到electron, 这个‘返回’过程可以使用<a target="_blank" rel="noopener" href="https://www.electronjs.org/docs/api/protocol">自定义协议</a>实现(QQs尚未实践), 亦可实现一个b/s的request &amp; response来完成。<br>renderUI<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">signinWithADB2C()&#123;</span><br><span class="line">  const adconfig&#x3D;&#123;</span><br><span class="line">    clientid:&#39;3c744214-bf78-4f92-8173-49863ae8f24b&#39;,</span><br><span class="line">    authority:&#39;https:&#x2F;&#x2F;qqstudio.b2clogin.com&#x2F;qqstudio.onmicrosoft.com&#x2F;B2C_1_basic_sign_up_and_sign_in&#39;,</span><br><span class="line">    redirectUri:&#39;http:&#x2F;&#x2F;localhost:9990&#x2F;index.html&#39;,</span><br><span class="line">    scopes:&#39;3c744214-bf78-4f92-8173-49863ae8f24b openid&#39;</span><br><span class="line">  &#125;</span><br><span class="line">  &#x2F;&#x2F; make up &#x2F; assemble authority URL</span><br><span class="line">  const authorityURL &#x3D; &#96;$&#123;adconfig.authority&#125;&#x2F;oauth2&#x2F;v2.0&#x2F;authorize?client_id&#x3D;$&#123;</span><br><span class="line">    adconfig.clientid</span><br><span class="line">  &#125;&amp;redirect_uri&#x3D;$&#123;</span><br><span class="line">    encodeURI(adconfig.redirectUri)</span><br><span class="line">  &#125;&amp;scope&#x3D;$&#123;</span><br><span class="line">    encodeURI(adconfig.scopes)</span><br><span class="line">  &#125;&amp;response_type&#x3D;id_token%20token&amp;nonce&#x3D;defaultNonce&amp;prompt&#x3D;login&#96;;</span><br><span class="line">  &#x2F;&#x2F; call main process open URL with default browser</span><br><span class="line">  &#x2F;&#x2F; meanwhile launch a http server</span><br><span class="line">  this.ipcService.send(&#39;openinbroweser&#39;, authorityURL);</span><br><span class="line">  this.loading &#x3D; true;</span><br><span class="line">  &#x2F;&#x2F; listen Logged in message</span><br><span class="line">  this.ipcService.on(&#39;access_token&#39;, msg &#x3D;&gt; &#123;</span><br><span class="line">    &#x2F;&#x2F; TODO process user info</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>main 主线程中launch一个http server，负责提供Redirect URI的页面，页面自执行request请求，请求亦由http server响应<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">....</span><br><span class="line">ipcMain.on(&#39;openinbroweser&#39;, (event, args) &#x3D;&gt; &#123;</span><br><span class="line">  log(&#39;info&#39;, &#39;ipcmain event:openinbroweser&#39;);</span><br><span class="line">  if (args) &#123;</span><br><span class="line">    const &#123; shell &#125; &#x3D; require(&#39;electron&#39;);</span><br><span class="line">    shell.openExternal(args);</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    log(&#39;error&#39;, &#39;invalid website&#39;, args);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; launch a http server</span><br><span class="line">var static &#x3D; require(&#39;node-static&#39;);</span><br><span class="line">var file &#x3D; new static.Server(&#96;$&#123;__dirname&#125;&#x2F;public&#96;);</span><br><span class="line">http.createServer(function (request, response) &#123;</span><br><span class="line">  if(request.url&#x3D;&#x3D;&#x3D;&#39;&#x2F;index.html&#39;)&#123;</span><br><span class="line">    request.addListener(&#39;end&#39;, function () &#123;</span><br><span class="line">        file.serve(request, response)</span><br><span class="line">    &#125;).resume();</span><br><span class="line">  &#125;else&#123;</span><br><span class="line">    const reg &#x3D; new RegExp(&quot;t&#x3D;([^&amp;]*)&quot;);</span><br><span class="line">    const res&#x3D; request.url.match(reg);</span><br><span class="line">    const token &#x3D; res[1];</span><br><span class="line">    console.log(&#39;t&#x3D;&#39;,token)</span><br><span class="line">    win.webContents.send(&#39;access_token&#39;,token)</span><br><span class="line">    response.write(&quot;success&quot;); &#x2F;&#x2F;close default browser</span><br><span class="line">  &#125;</span><br><span class="line">  response.end(); &#x2F;&#x2F;end the response</span><br><span class="line">&#125;).listen(9990)</span><br></pre></td></tr></table></figure><br>redirect page (public/index.html)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">  &lt;p&gt;serve by csportal&lt;&#x2F;p&gt;</span><br><span class="line">  &lt;script&gt;</span><br><span class="line">    (() &#x3D;&gt; &#123;</span><br><span class="line">      var reg &#x3D; new RegExp(&quot;#access_token&#x3D;([^&amp;]*)&quot;);</span><br><span class="line">      var res &#x3D; location.href.match(reg);</span><br><span class="line">      var token &#x3D; unescape(res[1]);</span><br><span class="line">      fetch(&#96;http:&#x2F;&#x2F;localhost:3000?t&#x3D;$&#123;token&#125;&#96;)</span><br><span class="line">        .then(function (response) &#123;</span><br><span class="line">          return response.json();</span><br><span class="line">        &#125;)</span><br><span class="line">        .catch(error &#x3D;&gt; console.error(&#39;Error:&#39;, error))</span><br><span class="line">        .then(response &#x3D;&gt; &#123;console.log(&#39;Success:&#39;, response);</span><br><span class="line">        window.close();</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;)();</span><br><span class="line">  &lt;&#x2F;script&gt;</span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure><br>Caution! 需考虑到浏览器将token传递给client的过程，都有被第三方恶意应用占用URL Scheme或者localhost端口截取Access Token的风险。在有”显式”授权流程的方式中，浏览器传递授权码，由client凭授权码换取token，同样无法杜绝第三方拦截。<br>了解使用<a target="_blank" rel="noopener" href="https://tonyxu.io/zh/posts/2018/oauth2-pkce-flow/">带有PKCE(Proof Key for Code Exchange)支持的授权码模式</a></p>
</blockquote>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://qqstone.github.io/qqsnote/2020/04/20/NSIS-macro/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/qqsnote/images/avatar.gif">
      <meta itemprop="name" content="QQs">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="QQs'Note">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/qqsnote/2020/04/20/NSIS-macro/" class="post-title-link" itemprop="url">NSIS宏</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-04-20 09:31:23" itemprop="dateCreated datePublished" datetime="2020-04-20T09:31:23+08:00">2020-04-20</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-07-05 10:07:52" itemprop="dateModified" datetime="2025-07-05T10:07:52+08:00">2025-07-05</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>NSIS（Nullsoft Scriptable Install System）</p>
<blockquote>
<p>Macros are used to insert code at compile time, depending on defines and using the values of the defines. The macro’s commands are inserted at compile time. This allows you to write general code only once and use it a lot of times but with few changes</p>
</blockquote>
<p>如上所述，宏的作用是“insert”代码，和通常的编程语言中的#define是一样的。insert的锚点标识是!insertmacro<br></p>
<h4 id="宏指令"><a href="#宏指令" class="headerlink" title="宏指令"></a>宏指令</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">!macro Hello</span><br><span class="line">  DetailPrint &quot;Hello world&quot;</span><br><span class="line">!macroend</span><br><span class="line"> </span><br><span class="line">Section Test</span><br><span class="line">  !insertmacro Hello</span><br><span class="line">SectionEnd</span><br></pre></td></tr></table></figure>
<h4 id="含参宏"><a href="#含参宏" class="headerlink" title="含参宏"></a>含参宏</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">!macro Hello What</span><br><span class="line">  DetailPrint &quot;Hello $&#123;What&#125;&quot;</span><br><span class="line">!macroend</span><br><span class="line"> </span><br><span class="line">Section Test</span><br><span class="line">  !insertmacro Hello &quot;World&quot;</span><br><span class="line">  !insertmacro Hello &quot;Tree&quot;</span><br><span class="line">  !insertmacro Hello &quot;Flower&quot;</span><br><span class="line">SectionEnd</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/qqsnote/page/22/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/qqsnote/">1</a><span class="space">&hellip;</span><a class="page-number" href="/qqsnote/page/22/">22</a><span class="page-number current">23</span><a class="page-number" href="/qqsnote/page/24/">24</a><span class="space">&hellip;</span><a class="page-number" href="/qqsnote/page/34/">34</a><a class="extend next" rel="next" href="/qqsnote/page/24/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">QQs</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/qqsnote/archives/">
        
          <span class="site-state-item-count">336</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/qqsnote/categories/">
        <span class="site-state-item-count">21</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/qqsnote/tags/">
        <span class="site-state-item-count">128</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



      </div>

      <div class="tag-cloud-tags">
        <a href="/qqsnote/tags/Net/" style="font-size: 30px; color: #fff">.Net</a> <a href="/qqsnote/tags/4G/" style="font-size: 12px; color: #ccc">4G</a> <a href="/qqsnote/tags/AI/" style="font-size: 22.5px; color: #eaeaea">AI</a> <a href="/qqsnote/tags/Android/" style="font-size: 12px; color: #ccc">Android</a> <a href="/qqsnote/tags/Angular/" style="font-size: 30px; color: #fff">Angular</a> <a href="/qqsnote/tags/Apache/" style="font-size: 13.5px; color: #d0d0d0">Apache</a> <a href="/qqsnote/tags/Azure/" style="font-size: 25.5px; color: #f2f2f2">Azure</a> <a href="/qqsnote/tags/Babylon/" style="font-size: 12px; color: #ccc">Babylon</a> <a href="/qqsnote/tags/C/" style="font-size: 16.5px; color: #d9d9d9">C#</a> <a href="/qqsnote/tags/C/" style="font-size: 16.5px; color: #d9d9d9">C++</a> <a href="/qqsnote/tags/CSS/" style="font-size: 19.5px; color: #e1e1e1">CSS</a> <a href="/qqsnote/tags/DevOps/" style="font-size: 15px; color: #d5d5d5">DevOps</a> <a href="/qqsnote/tags/Docker/" style="font-size: 16.5px; color: #d9d9d9">Docker</a> <a href="/qqsnote/tags/ES6/" style="font-size: 12px; color: #ccc">ES6</a> <a href="/qqsnote/tags/ESLint/" style="font-size: 12px; color: #ccc">ESLint</a> <a href="/qqsnote/tags/ElasticSearch/" style="font-size: 12px; color: #ccc">ElasticSearch</a> <a href="/qqsnote/tags/Electron/" style="font-size: 16.5px; color: #d9d9d9">Electron</a> <a href="/qqsnote/tags/ElementUI/" style="font-size: 12px; color: #ccc">ElementUI</a> <a href="/qqsnote/tags/EntityFramework/" style="font-size: 13.5px; color: #d0d0d0">EntityFramework</a> <a href="/qqsnote/tags/EventBus/" style="font-size: 12px; color: #ccc">EventBus</a> <a href="/qqsnote/tags/Excel/" style="font-size: 12px; color: #ccc">Excel</a> <a href="/qqsnote/tags/FastDFS/" style="font-size: 12px; color: #ccc">FastDFS</a> <a href="/qqsnote/tags/Figma/" style="font-size: 12px; color: #ccc">Figma</a> <a href="/qqsnote/tags/Go/" style="font-size: 12px; color: #ccc">Go</a> <a href="/qqsnote/tags/GraphQL/" style="font-size: 12px; color: #ccc">GraphQL</a> <a href="/qqsnote/tags/Jasmine/" style="font-size: 12px; color: #ccc">Jasmine</a> <a href="/qqsnote/tags/Java/" style="font-size: 13.5px; color: #d0d0d0">Java</a> <a href="/qqsnote/tags/Jenkins/" style="font-size: 21px; color: #e6e6e6">Jenkins</a> <a href="/qqsnote/tags/Linux/" style="font-size: 22.5px; color: #eaeaea">Linux</a> <a href="/qqsnote/tags/MQ/" style="font-size: 12px; color: #ccc">MQ</a> <a href="/qqsnote/tags/Markdown/" style="font-size: 13.5px; color: #d0d0d0">Markdown</a> <a href="/qqsnote/tags/MongoDB/" style="font-size: 12px; color: #ccc">MongoDB</a> <a href="/qqsnote/tags/Monorepo/" style="font-size: 12px; color: #ccc">Monorepo</a> <a href="/qqsnote/tags/MySQL/" style="font-size: 12px; color: #ccc">MySQL</a> <a href="/qqsnote/tags/NSIS/" style="font-size: 12px; color: #ccc">NSIS</a> <a href="/qqsnote/tags/Nginx/" style="font-size: 12px; color: #ccc">Nginx</a> <a href="/qqsnote/tags/NoSQL/" style="font-size: 12px; color: #ccc">NoSQL</a> <a href="/qqsnote/tags/Node-js/" style="font-size: 18px; color: #ddd">Node.js</a> <a href="/qqsnote/tags/OData/" style="font-size: 13.5px; color: #d0d0d0">OData</a> <a href="/qqsnote/tags/OpenCV/" style="font-size: 18px; color: #ddd">OpenCV</a> <a href="/qqsnote/tags/OpenGL/" style="font-size: 13.5px; color: #d0d0d0">OpenGL</a> <a href="/qqsnote/tags/PHP/" style="font-size: 12px; color: #ccc">PHP</a> <a href="/qqsnote/tags/PWA/" style="font-size: 12px; color: #ccc">PWA</a> <a href="/qqsnote/tags/PyCharm/" style="font-size: 12px; color: #ccc">PyCharm</a> <a href="/qqsnote/tags/Python/" style="font-size: 24px; color: #eee">Python</a> <a href="/qqsnote/tags/R3F/" style="font-size: 12px; color: #ccc">R3F</a> <a href="/qqsnote/tags/React/" style="font-size: 21px; color: #e6e6e6">React</a> <a href="/qqsnote/tags/SQL/" style="font-size: 12px; color: #ccc">SQL</a> <a href="/qqsnote/tags/SQL-Server/" style="font-size: 15px; color: #d5d5d5">SQL_Server</a> <a href="/qqsnote/tags/ServiceWorker/" style="font-size: 12px; color: #ccc">ServiceWorker</a> <a href="/qqsnote/tags/Shell/" style="font-size: 12px; color: #ccc">Shell</a> <a href="/qqsnote/tags/Three-js/" style="font-size: 16.5px; color: #d9d9d9">Three.js</a> <a href="/qqsnote/tags/TypeScript/" style="font-size: 13.5px; color: #d0d0d0">TypeScript</a> <a href="/qqsnote/tags/UE/" style="font-size: 12px; color: #ccc">UE</a> <a href="/qqsnote/tags/UI/" style="font-size: 12px; color: #ccc">UI</a> <a href="/qqsnote/tags/UML/" style="font-size: 12px; color: #ccc">UML</a> <a href="/qqsnote/tags/Virtualbox/" style="font-size: 12px; color: #ccc">Virtualbox</a> <a href="/qqsnote/tags/WPF/" style="font-size: 12px; color: #ccc">WPF</a> <a href="/qqsnote/tags/WebGL/" style="font-size: 21px; color: #e6e6e6">WebGL</a> <a href="/qqsnote/tags/WebService/" style="font-size: 12px; color: #ccc">WebService</a> <a href="/qqsnote/tags/Web%E5%8D%8F%E8%AE%AE/" style="font-size: 12px; color: #ccc">Web协议</a> <a href="/qqsnote/tags/Web%E5%BC%80%E5%8F%91/" style="font-size: 27px; color: #f7f7f7">Web开发</a> <a href="/qqsnote/tags/Wechat/" style="font-size: 12px; color: #ccc">Wechat</a> <a href="/qqsnote/tags/aigc/" style="font-size: 12px; color: #ccc">aigc</a> <a href="/qqsnote/tags/auth/" style="font-size: 12px; color: #ccc">auth</a> <a href="/qqsnote/tags/axios/" style="font-size: 12px; color: #ccc">axios</a> <a href="/qqsnote/tags/canvas/" style="font-size: 12px; color: #ccc">canvas</a> <a href="/qqsnote/tags/css/" style="font-size: 12px; color: #ccc">css</a> <a href="/qqsnote/tags/express/" style="font-size: 12px; color: #ccc">express</a> <a href="/qqsnote/tags/ftp/" style="font-size: 12px; color: #ccc">ftp</a> <a href="/qqsnote/tags/git/" style="font-size: 13.5px; color: #d0d0d0">git</a> <a href="/qqsnote/tags/hexo/" style="font-size: 12px; color: #ccc">hexo</a> <a href="/qqsnote/tags/http/" style="font-size: 12px; color: #ccc">http</a> <a href="/qqsnote/tags/http2/" style="font-size: 12px; color: #ccc">http2</a> <a href="/qqsnote/tags/https/" style="font-size: 12px; color: #ccc">https</a> <a href="/qqsnote/tags/ionic/" style="font-size: 12px; color: #ccc">ionic</a> <a href="/qqsnote/tags/javascript/" style="font-size: 28.5px; color: #fbfbfb">javascript</a> <a href="/qqsnote/tags/k8s/" style="font-size: 12px; color: #ccc">k8s</a> <a href="/qqsnote/tags/login/" style="font-size: 12px; color: #ccc">login</a> <a href="/qqsnote/tags/loopback/" style="font-size: 12px; color: #ccc">loopback</a> <a href="/qqsnote/tags/ngrok/" style="font-size: 12px; color: #ccc">ngrok</a> <a href="/qqsnote/tags/npm/" style="font-size: 12px; color: #ccc">npm</a> <a href="/qqsnote/tags/nsis/" style="font-size: 13.5px; color: #d0d0d0">nsis</a> <a href="/qqsnote/tags/redis/" style="font-size: 12px; color: #ccc">redis</a> <a href="/qqsnote/tags/sqlServer/" style="font-size: 12px; color: #ccc">sqlServer</a> <a href="/qqsnote/tags/ssh/" style="font-size: 12px; color: #ccc">ssh</a> <a href="/qqsnote/tags/svg/" style="font-size: 12px; color: #ccc">svg</a> <a href="/qqsnote/tags/trea/" style="font-size: 12px; color: #ccc">trea</a> <a href="/qqsnote/tags/vtk/" style="font-size: 16.5px; color: #d9d9d9">vtk</a> <a href="/qqsnote/tags/vuejs/" style="font-size: 19.5px; color: #e1e1e1">vuejs</a> <a href="/qqsnote/tags/webassembly/" style="font-size: 15px; color: #d5d5d5">webassembly</a> <a href="/qqsnote/tags/webpack/" style="font-size: 12px; color: #ccc">webpack</a> <a href="/qqsnote/tags/websocket/" style="font-size: 12px; color: #ccc">websocket</a> <a href="/qqsnote/tags/windows/" style="font-size: 12px; color: #ccc">windows</a> <a href="/qqsnote/tags/yarn/" style="font-size: 12px; color: #ccc">yarn</a> <a href="/qqsnote/tags/%E4%B8%8A%E4%BC%A0/" style="font-size: 12px; color: #ccc">上传</a> <a href="/qqsnote/tags/%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/" style="font-size: 12px; color: #ccc">内网穿透</a> <a href="/qqsnote/tags/%E5%8A%A0%E5%AF%86/" style="font-size: 16.5px; color: #d9d9d9">加密</a> <a href="/qqsnote/tags/%E5%8C%BB%E5%AD%A6%E5%9B%BE%E5%83%8F/" style="font-size: 13.5px; color: #d0d0d0">医学图像</a> <a href="/qqsnote/tags/%E5%8D%9A%E5%BC%88%E8%AE%BA/" style="font-size: 12px; color: #ccc">博弈论</a> <a href="/qqsnote/tags/%E5%9B%BE%E5%83%8F%E5%A4%84%E7%90%86/" style="font-size: 12px; color: #ccc">图像处理</a> <a href="/qqsnote/tags/%E5%9B%BE%E5%BD%A2%E5%AD%A6/" style="font-size: 18px; color: #ddd">图形学</a> <a href="/qqsnote/tags/%E5%A4%9A%E8%AF%AD%E8%A8%80/" style="font-size: 13.5px; color: #d0d0d0">多语言</a> <a href="/qqsnote/tags/%E5%A4%A7%E6%A8%A1%E5%9E%8B/" style="font-size: 12px; color: #ccc">大模型</a> <a href="/qqsnote/tags/%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B/" style="font-size: 12px; color: #ccc">存储过程</a> <a href="/qqsnote/tags/%E6%80%A7%E8%83%BD/" style="font-size: 15px; color: #d5d5d5">性能</a> <a href="/qqsnote/tags/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/" style="font-size: 13.5px; color: #d0d0d0">性能优化</a> <a href="/qqsnote/tags/%E6%88%90%E9%95%BF%E6%80%9D%E7%BB%B4/" style="font-size: 12px; color: #ccc">成长思维</a> <a href="/qqsnote/tags/%E6%91%84%E5%BD%B1/" style="font-size: 12px; color: #ccc">摄影</a> <a href="/qqsnote/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" style="font-size: 12px; color: #ccc">操作系统</a> <a href="/qqsnote/tags/%E6%95%B0%E5%AD%97%E7%AD%BE%E5%90%8D/" style="font-size: 12px; color: #ccc">数字签名</a> <a href="/qqsnote/tags/%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96/" style="font-size: 12px; color: #ccc">数据可视化</a> <a href="/qqsnote/tags/%E6%95%B0%E6%8D%AE%E5%BA%93%E9%94%81/" style="font-size: 12px; color: #ccc">数据库锁</a> <a href="/qqsnote/tags/%E6%A0%91%E8%8E%93%E6%B4%BE/" style="font-size: 12px; color: #ccc">树莓派</a> <a href="/qqsnote/tags/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/" style="font-size: 12px; color: #ccc">正则表达式</a> <a href="/qqsnote/tags/%E7%89%A9%E8%81%94%E7%BD%91/" style="font-size: 12px; color: #ccc">物联网</a> <a href="/qqsnote/tags/%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F/" style="font-size: 13.5px; color: #d0d0d0">环境变量</a> <a href="/qqsnote/tags/%E7%AE%97%E6%B3%95/" style="font-size: 16.5px; color: #d9d9d9">算法</a> <a href="/qqsnote/tags/%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/" style="font-size: 12px; color: #ccc">编码规范</a> <a href="/qqsnote/tags/%E8%8B%B1%E8%AF%AD/" style="font-size: 12px; color: #ccc">英语</a> <a href="/qqsnote/tags/%E8%A7%86%E9%A2%91%E6%B5%81/" style="font-size: 12px; color: #ccc">视频流</a> <a href="/qqsnote/tags/%E8%A7%A6%E5%8F%91%E5%99%A8/" style="font-size: 12px; color: #ccc">触发器</a> <a href="/qqsnote/tags/%E8%AE%A4%E8%AF%81-%E6%8E%88%E6%9D%83/" style="font-size: 21px; color: #e6e6e6">认证&授权</a> <a href="/qqsnote/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" style="font-size: 12px; color: #ccc">设计模式</a> <a href="/qqsnote/tags/%E8%AF%BB%E4%B9%A6/" style="font-size: 12px; color: #ccc">读书</a> <a href="/qqsnote/tags/%E8%BF%9B%E7%A8%8B%E5%AE%88%E6%8A%A4/" style="font-size: 12px; color: #ccc">进程守护</a> <a href="/qqsnote/tags/%E9%9D%A2%E8%AF%95/" style="font-size: 13.5px; color: #d0d0d0">面试</a> <a href="/qqsnote/tags/%E9%A6%99%E6%A9%99%E6%B4%BE/" style="font-size: 12px; color: #ccc">香橙派</a>
      </div>
    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">QQs</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/qqsnote/lib/anime.min.js"></script>
  <script src="/qqsnote/lib/velocity/velocity.min.js"></script>
  <script src="/qqsnote/lib/velocity/velocity.ui.min.js"></script>

<script src="/qqsnote/js/utils.js"></script>

<script src="/qqsnote/js/motion.js"></script>


<script src="/qqsnote/js/schemes/muse.js"></script>


<script src="/qqsnote/js/next-boot.js"></script>




  




  
<script src="/qqsnote/js/local-search.js"></script>













  

  

  

</body>
</html>
